<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Lichord">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Lichord">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lichord">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Lichord</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Lichord</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">学习笔记</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/23/内存溢出内存泄露/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lichord">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lichord">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/23/内存溢出内存泄露/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-23 12:34:24" itemprop="dateCreated datePublished" datetime="2020-03-23T12:34:24+08:00">2020-03-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-11-04 10:38:28" itemprop="dateModified" datetime="2019-11-04T10:38:28+08:00">2019-11-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="内存溢出"><a href="#内存溢出" class="headerlink" title="内存溢出"></a>内存溢出</h2><h3 id="OutOfMemoryError：PermGen-space"><a href="#OutOfMemoryError：PermGen-space" class="headerlink" title="OutOfMemoryError：PermGen space"></a>OutOfMemoryError：PermGen space</h3><p>PermGen space就是永久保存区，也就是直接内存。该块内存主要是被JVM用来存放class和mete信息的，当class被加载loader的时候就会被存储到该内存区中，与存放类的实例的heap区不同，java中的垃圾回收器GC不会在主程序运行期对PermGen space进行清理。</p>
<p>出错原因：系统的代码非常多或引用的第三方包非常多或者通过动态代码生成类加载等方法，导致元空间的内存占用很大。</p>
<p>解决方案：增加空间分配——增加java虚拟机中的XX:PermSize和XX:MaxPermSize参数的大小，其中XX:PermSize是初始永久保存区域大小，XX:MaxPermSize是最大永久保存区域大小。</p>
<h3 id="OutOfMemoryError：Java-heap-space"><a href="#OutOfMemoryError：Java-heap-space" class="headerlink" title="OutOfMemoryError：Java heap space"></a>OutOfMemoryError：Java heap space</h3><p>heap是Java内存中的堆区，主要用来存放对象，当对象太多超出了空间大小，GC又来不及释放的时候，就会发生溢出错误。即内存泄露越来越严重时，可能会发生内存溢出。</p>
<p>要么代码有问题，要么访问量太多并且每个访问的时间太长或者数据太多，导致数据释放不掉</p>
<p>解决方案：</p>
<ul>
<li>检查程序，减少大量重复创建对象的死循环，减少内存泄露。</li>
<li>如果代码没有什么问题的情况下，可以适当调整-Xms和-Xmx两个jvm参数，使用压力测试来调整这两个参数达到最优值。</li>
<li>尽量避免大的对象的申请，像文件上传，大批量从数据库中获取，这是需要避免的，尽量分块或者分批处理，有助于系统的正常稳定的执行。</li>
<li>尽量提高一次请求的执行速度，垃圾回收越早越好，否则，大量的并发来了的时候，再来新的请求就无法分配内存了，就容易造成系统的雪崩。</li>
</ul>
<h3 id="StackOverFlowError"><a href="#StackOverFlowError" class="headerlink" title="StackOverFlowError"></a>StackOverFlowError</h3><p>stack是Java内存中的栈空间，主要用来存放方法中的变量，参数等临时性的数据的，发生溢出一般是因为分配空间太小，或是执行的方法递归层数太多创建了占用了太多栈帧导致溢出。</p>
<p>解决方案：修改配置参数-Xss参数增加线程栈大小之外，优化程序是尤其重要。</p>
<h2 id="内存泄漏"><a href="#内存泄漏" class="headerlink" title="内存泄漏"></a>内存泄漏</h2><p>内存泄漏是堆中的存在无用但可达的对象，GC无法回收</p>
<p>分类</p>
<ol>
<li>常发性内存泄漏。发生内存泄漏的代码会被多次执行到，每次被执行的时候都会导致一块内存泄漏。</li>
<li>偶发性内存泄漏。发生内存泄漏的代码只有在某些特定环境或操作过程下才会发生。常发性和偶发性是相对的。对于特定的环境，偶发性的也许就变成了常发性的。所以测试环境和测试方法对检测内存泄漏至关重要。</li>
<li>一次性内存泄漏。发生内存泄漏的代码只会被执行一次，或者由于算法上的缺陷，导致总会有一块仅且一块内存发生泄漏。比如，在类的构造函数中分配内存，在析构函数中却没有释放该内存，所以内存泄漏只会发生一次。</li>
<li>隐式内存泄漏。程序在运行过程中不停的分配内存，但是直到结束的时候才释放内存。严格的说这里并没有发生内存泄漏，因为最终程序释放了所有申请的内存。但是对于一个服务器程序，需要运行几天，几周甚至几个月，不及时释放内存也可能导致最终耗尽系统的所有内存。所以，我们称这类内存泄漏为隐式内存泄漏。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//循环申请对象o，并将o放入容器中，虽然我们释放了o，但是由于容器还引用这这个对象，所以GC仍然是不会回收的。我们需要通过释放容器才能被GC回收</span></span><br><span class="line">Vector v=<span class="keyword">new</span> Vector(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;<span class="number">100</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">    Object o=<span class="keyword">new</span> Object();</span><br><span class="line">    v.add(o);</span><br><span class="line">    o=<span class="keyword">null</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/22/java_容器_List/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lichord">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lichord">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/22/java_容器_List/" class="post-title-link" itemprop="url">Java_容器_List</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-10-22 19:29:51 / 修改时间：19:24:58" itemprop="dateCreated datePublished" datetime="2019-10-22T19:29:51+08:00">2019-10-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h1><h2 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//add</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span><span class="comment">//在链表尾部添加一个元素，如果成功，返回true，否则返回false； </span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addFirst</span><span class="params">(E e)</span><span class="comment">//在链表头部插入一个元素； </span></span></span><br><span class="line"><span class="function"><span class="title">addLast</span><span class="params">(E e)</span><span class="comment">//在链表尾部添加一个元素； </span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E element)</span><span class="comment">//在指定位置插入一个元素。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//remove</span></span></span><br><span class="line"><span class="function">E <span class="title">remove</span><span class="params">()</span><span class="comment">//移除链表中第一个元素；</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span><span class="comment">//移除链表中指定的元素； </span></span></span><br><span class="line"><span class="function">E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span><span class="comment">//移除链表中指定位置的元素；  </span></span></span><br><span class="line"><span class="function">E <span class="title">removeFirst</span><span class="params">()</span><span class="comment">//：移除链表中第一个元素，与remove类似； </span></span></span><br><span class="line"><span class="function">E <span class="title">removeLast</span><span class="params">()</span><span class="comment">//：移除链表中最后一个元素； </span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">removeFirstOccurrence</span><span class="params">(Object o)</span><span class="comment">//移除链表中第一次出现所在位置的元素； </span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">removeLastOccurrence</span><span class="params">(Object o)</span><span class="comment">//移除链表中最后一次出现所在位置的元素；</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//get</span></span></span><br><span class="line"><span class="function">E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span><span class="comment">//按照下边获取元素； </span></span></span><br><span class="line"><span class="function">E <span class="title">getFirst</span><span class="params">()</span><span class="comment">//获取第一个元素； </span></span></span><br><span class="line"><span class="function">E <span class="title">getLast</span><span class="params">()</span><span class="comment">//获取第二个元素；</span></span></span><br><span class="line"><span class="function">--------------------------------------------</span></span><br><span class="line"><span class="function"><span class="comment">//掌握上面一组增删查就够用了</span></span></span><br><span class="line"><span class="function"><span class="comment">//offer</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">offer</span><span class="params">(E e)</span><span class="comment">//与add一样 </span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">offerFirst</span><span class="params">(E e)</span><span class="comment">//与addFirst一样</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">offerLast</span><span class="params">(E e)</span><span class="comment">//与addLast一样</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//push pop poll</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(E e)</span><span class="comment">//与addFirst一样</span></span></span><br><span class="line"><span class="function">E <span class="title">pop</span><span class="params">()</span><span class="comment">//与removeFirst一样</span></span></span><br><span class="line"><span class="function">E <span class="title">poll</span><span class="params">()</span><span class="comment">//查询并移除第一个元素</span></span></span><br><span class="line"><span class="function"><span class="comment">//链表为空时，poll返回null, pop产生异常</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//peek</span></span></span><br><span class="line"><span class="function">E <span class="title">peek</span><span class="params">()</span><span class="comment">//获取第一个元素，但是不移除； </span></span></span><br><span class="line"><span class="function">E <span class="title">peekFirst</span><span class="params">()</span><span class="comment">//获取第一个元素，但是不移除； </span></span></span><br><span class="line"><span class="function">E <span class="title">peekLast</span><span class="params">()</span><span class="comment">//获取最后一个元素，但是不移除；</span></span></span><br><span class="line"><span class="function">---------------------------------------------</span></span><br><span class="line"><span class="function"><span class="comment">//其他 </span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span></span>;<span class="comment">//判断是否包含某元素</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> index,E element)</span></span>;<span class="comment">//修改指定位置元素</span></span><br><span class="line"><span class="function">List <span class="title">subList</span><span class="params">(<span class="keyword">int</span> fromIndex,<span class="keyword">int</span> toIndex)</span></span>;<span class="comment">//返回[,from,to)区间的新链表，不会修改原链表</span></span><br><span class="line">clear();<span class="comment">//清空</span></span><br></pre></td></tr></table></figure>

<h2 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h2><ul>
<li>继承于AbstractSequentialList的双向链表:可以被当作堆栈、队列或双端队列进行操作。</li>
<li>实现 List 接口，能进行队列操作。</li>
<li>实现 Deque 接口，能将LinkedList当作双端队列使用<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedList</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">AbstractSequentialList</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt;, <span class="title">Deque</span>&lt;<span class="title">E</span>&gt;, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span>&#123;...&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>基于双向链表实现，使用 Node 存储链表节点信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">  E item;</span><br><span class="line">  Node&lt;E&gt; next;</span><br><span class="line">  Node&lt;E&gt; prev;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>每个链表存储了 first 和 last 指针：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">transient</span> Node&lt;E&gt; first;</span><br><span class="line"><span class="keyword">transient</span> Node&lt;E&gt; last;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2019/09/16/W2EnATR8I3Kw9sl.png" alt="链表.png"><br>LinkedList的源码也就是普通的链表操作，没有什么难点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构造函数</span></span><br><span class="line"><span class="comment">//空参构造</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LinkedList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//传入其他Collection转换成LinkedList</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LinkedList</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>();</span><br><span class="line">    addAll(c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> addAll(size, c);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//转换方式就是先变成数组类型，再将数组中的元素依次创建结点放在List中</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(<span class="keyword">int</span> index, Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">    checkPositionIndex(index);</span><br><span class="line"></span><br><span class="line">    Object[] a = c.toArray();</span><br><span class="line">    <span class="keyword">int</span> numNew = a.length;</span><br><span class="line">    <span class="keyword">if</span> (numNew == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    Node&lt;E&gt; pred, succ;</span><br><span class="line">    <span class="keyword">if</span> (index == size) &#123;</span><br><span class="line">        succ = <span class="keyword">null</span>;</span><br><span class="line">        pred = last;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        succ = node(index);</span><br><span class="line">        pred = succ.prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Object o : a) &#123;</span><br><span class="line">        <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>) E e = (E) o;</span><br><span class="line">        Node&lt;E&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(pred, e, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (pred == <span class="keyword">null</span>)</span><br><span class="line">            first = newNode;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            pred.next = newNode;</span><br><span class="line">        pred = newNode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (succ == <span class="keyword">null</span>) &#123;</span><br><span class="line">        last = pred;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        pred.next = succ;</span><br><span class="line">        succ.prev = pred;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    size += numNew;</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//链表存储了first last指针，所以对头尾结点增删查非常好实现</span></span><br></pre></td></tr></table></figure>

<h2 id="与-ArrayList-的比较"><a href="#与-ArrayList-的比较" class="headerlink" title="与 ArrayList 的比较"></a>与 ArrayList 的比较</h2><ul>
<li>ArrayList 基于动态数组实现，LinkedList 基于双向链表实现；</li>
<li>ArrayList 支持随机访问，LinkedList 不支持；</li>
<li>LinkedList 在任意位置添加删除元素更快</li>
</ul>
<h3 id="遍历方法及效率"><a href="#遍历方法及效率" class="headerlink" title="遍历方法及效率"></a>遍历方法及效率</h3><p>Linkedlist不支持随机访问，所以使用访问next的方式便利更高效。ArrayList使用for随机访问更高效。foreach本质上是使用iterator实现的。</p>
<ul>
<li>Linkedlist : foreach &gt; iterator &gt;for</li>
<li>ArrayList ：for &gt;foreach &gt;iterator</li>
</ul>
<p>参考：<a href="https://www.cnblogs.com/aoguren/p/4771589.html" target="_blank" rel="noopener">https://www.cnblogs.com/aoguren/p/4771589.html</a></p>
<h1 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h1><h2 id="常用方法-1"><a href="#常用方法-1" class="headerlink" title="常用方法"></a>常用方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建</span></span><br><span class="line">ArrayList&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"><span class="comment">//指定容量大小</span></span><br><span class="line">ArrayList&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;Integer&gt;(<span class="number">7</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//add</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">add</span><span class="params">(Element e)</span><span class="comment">//增加指定元素到链表尾部.</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, Element e)</span><span class="comment">//增加指定元素到链表指定位置</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//remove</span></span></span><br><span class="line"><span class="function">E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span></span></span><br><span class="line"><span class="function">E <span class="title">remove</span><span class="params">(Object o)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//get</span></span></span><br><span class="line"><span class="function">E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span>获取链表中指定位置处的元素</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//set</span></span></span><br><span class="line"><span class="function">E <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E element)</span><span class="comment">//将链表中指定位置上的元素替换成新元素。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">Object[] <span class="title">toArray</span><span class="params">()</span> <span class="comment">//即将链表转换为一个数组</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(Object o)</span><span class="comment">//返回元素在链表中第一次出现的位置，没有返回-1</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lastIndexOf</span><span class="params">(Object o)</span><span class="comment">//返回元素在链表中最后一次出现的位置，没有返回-1</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span><span class="comment">//如果链表包含指定元素，返回true.</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<p><a href="https://www.cnblogs.com/kungfupanda/p/7357142.html" target="_blank" rel="noopener">参考：实例讲解ArrayList用法</a></p>
<h2 id="源码分析-1"><a href="#源码分析-1" class="headerlink" title="源码分析"></a>源码分析</h2><ul>
<li>ArrayList 继承了AbstractList，实现了List。它是一个数组队列，提供了相关的添加、删除、修改、遍历等功能。</li>
<li>实现了Cloneable 接口，即覆盖了函数 clone()，能被克隆。</li>
<li>实现java.io.Serializable 接口，这意味着ArrayList支持序列化，能通过序列化去传输。</li>
<li>实现了 RandomAccess 接口，因此支持随机访问。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt;, <span class="title">RandomAccess</span>, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="构造方法-3种"><a href="#构造方法-3种" class="headerlink" title="构造方法(3种)"></a>构造方法(3种)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CAPACITY = <span class="number">10</span>;</span><br><span class="line"><span class="comment">//空参构造,实际上初始化赋值一个空数组，当真正对数组添加元素时，才真正分配大小=10</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</span></span><br><span class="line">    <span class="keyword">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建ArrayList时传入初始容量</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//创建指定大小的数组</span></span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.elementData = <span class="keyword">new</span> Object[initialCapacity];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (initialCapacity == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal Capacity: "</span>+</span><br><span class="line">                                            initialCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//支持传入一个集合，将集合转换成ArrayList类型</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">    elementData = c.toArray();</span><br><span class="line">    <span class="keyword">if</span> ((size = elementData.length) != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// defend against c.toArray (incorrectly) not returning Object[]</span></span><br><span class="line">        <span class="comment">// (see e.g. https://bugs.openjdk.java.net/browse/JDK-6260652)</span></span><br><span class="line">        <span class="keyword">if</span> (elementData.getClass() != Object[].class)</span><br><span class="line">            elementData = Arrays.copyOf(elementData, size, Object[].class);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// replace with empty array.</span></span><br><span class="line">        <span class="keyword">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(E e, Object[] elementData, <span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//数组没有空间了就进行扩容</span></span><br><span class="line">    <span class="keyword">if</span> (s == elementData.length)</span><br><span class="line">        <span class="comment">//扩容后的大小是之前大小的1.5倍</span></span><br><span class="line">        elementData = grow();</span><br><span class="line">    elementData[s] = e;</span><br><span class="line">    size = s + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//在数组末尾插入数据</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    modCount++;</span><br><span class="line">    add(e, elementData, size);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//指定位置插入数据</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//检测下标是否越界</span></span><br><span class="line">    rangeCheckForAdd(index);</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> s;</span><br><span class="line">    Object[] elementData;</span><br><span class="line">    <span class="keyword">if</span> ((s = size) == (elementData = <span class="keyword">this</span>.elementData).length)</span><br><span class="line">        elementData = grow();</span><br><span class="line">    <span class="comment">//把index之后的所有元素向后移一位</span></span><br><span class="line">    <span class="comment">//elementData 源数组 index:源数组中起始位置</span></span><br><span class="line">    <span class="comment">//elementData 目标数组 index:目标数组中起始位置</span></span><br><span class="line">    <span class="comment">//s - index:要复制的数组元素的数量</span></span><br><span class="line">    System.arraycopy(elementData, index,</span><br><span class="line">                        elementData, index + <span class="number">1</span>,</span><br><span class="line">                        s - index);</span><br><span class="line">    elementData[index] = element;</span><br><span class="line">    size = s + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="扩容-重点"><a href="#扩容-重点" class="headerlink" title="扩容(重点)"></a>扩容(重点)</h3><p>插入数据时没有空间了就进行扩容。</p>
<p>使用 grow() 方法进行扩容，新容量的大小为  oldCapacity + (oldCapacity &gt;&gt; 1) ，也就是旧容量的 1.5 倍。</p>
<p>扩容操作需要调用  Arrays.copyOf() 把原数组整个复制到新数组中，这个操作代价很高，因此最好在创建ArrayList 对象时就指定大概的容量大小，减少扩容操作的次数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Object[] grow(<span class="keyword">int</span> minCapacity) &#123;</span><br><span class="line">    <span class="comment">//elementData:要复制的数组，newCapacity(minCapacity)：复制的长度</span></span><br><span class="line">    <span class="keyword">return</span> elementData = Arrays.copyOf(elementData,</span><br><span class="line">                                        newCapacity(minCapacity));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Object[] grow() &#123;</span><br><span class="line">    <span class="keyword">return</span> grow(size + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">newCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// overflow-conscious code</span></span><br><span class="line">        <span class="keyword">int</span> oldCapacity = elementData.length;</span><br><span class="line">        <span class="keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (newCapacity - minCapacity &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA)</span><br><span class="line">                <span class="keyword">return</span> Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">            <span class="keyword">if</span> (minCapacity &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> OutOfMemoryError();</span><br><span class="line">            <span class="keyword">return</span> minCapacity;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (newCapacity - MAX_ARRAY_SIZE &lt;= <span class="number">0</span>)</span><br><span class="line">            ? newCapacity</span><br><span class="line">            : hugeCapacity(minCapacity);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><p>需要调用 System.arraycopy() 将 index+1 后面的元素都复制到 index 位置上，该操作的时间复杂度为 O(N)，可以看出ArrayList 删除元素的代价是非常高的。</p>
<p>ArrayList源码大量使用了System.arrayCopy()和Arrays.copyOf()方法</p>
<p>copyOf()内部实际上调用了System.arrayCopy()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//固定位置删除，返回要删除的元素</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    Objects.checkIndex(index, size);</span><br><span class="line"></span><br><span class="line">    modCount++;</span><br><span class="line">    E oldValue = elementData(index);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> numMoved = size - index - <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//向前移动一位</span></span><br><span class="line">    <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>)</span><br><span class="line">        System.arraycopy(elementData, index+<span class="number">1</span>, elementData, index,</span><br><span class="line">                            numMoved);</span><br><span class="line">    <span class="comment">//最后一位置空，size减小1</span></span><br><span class="line">    elementData[--size] = <span class="keyword">null</span>; <span class="comment">// clear to let GC do its work</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> oldValue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//删除指定元素</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; size; index++)</span><br><span class="line">            <span class="keyword">if</span> (elementData[index] == <span class="keyword">null</span>) &#123;</span><br><span class="line">                fastRemove(index);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; size; index++)</span><br><span class="line">            <span class="keyword">if</span> (o.equals(elementData[index])) &#123;</span><br><span class="line">                fastRemove(index);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fastRemove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">int</span> numMoved = size - index - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>)</span><br><span class="line">        System.arraycopy(elementData, index+<span class="number">1</span>, elementData, index,</span><br><span class="line">                            numMoved);</span><br><span class="line">    elementData[--size] = <span class="keyword">null</span>; <span class="comment">// clear to let GC do its work</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="遍历时删除元素"><a href="#遍历时删除元素" class="headerlink" title="遍历时删除元素"></a>遍历时删除元素</h3><p>对集合进行遍历的时候，将集合的大小改变了就会报错</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//会报错 java.util.ConcurrentModificationException</span></span><br><span class="line">ArrayList &lt;Integer&gt; list=<span class="keyword">new</span> ArrayList();</span><br><span class="line">list.add(<span class="number">10</span>);</span><br><span class="line">list.add(<span class="number">11</span>);</span><br><span class="line">list.add(<span class="number">12</span>);</span><br><span class="line">list.add(<span class="number">13</span>);</span><br><span class="line">list.add(<span class="number">14</span>);</span><br><span class="line">list.add(<span class="number">15</span>);</span><br><span class="line">list.add(<span class="number">16</span>);</span><br><span class="line">list.add(<span class="number">17</span>);</span><br><span class="line"><span class="keyword">for</span>(Integer i: list)&#123;</span><br><span class="line">    <span class="keyword">if</span>(i==<span class="number">13</span>)&#123;</span><br><span class="line">        list.remove(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//同样报错</span></span><br><span class="line">Iterator&lt;Integer&gt;it=list.iterator();</span><br><span class="line"><span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">    Integer num=it.next();</span><br><span class="line">    <span class="keyword">if</span>(num==<span class="number">13</span>)&#123;</span><br><span class="line">        list.remove(num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//用迭代器删除可以解决</span></span><br><span class="line">Iterator&lt;Integer&gt;it=list.iterator();</span><br><span class="line"><span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">    Integer num=it.next();</span><br><span class="line">    <span class="keyword">if</span>(num==<span class="number">13</span>)&#123;</span><br><span class="line">        <span class="comment">//区别点</span></span><br><span class="line">        it.remove(num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ensureCapacity方法"><a href="#ensureCapacity方法" class="headerlink" title="ensureCapacity方法"></a>ensureCapacity方法</h3><p>大量添加元素之前最好先使用ensureCapacity()方法。可以减少扩容次数，提高效率</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ensureCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (minCapacity &gt; elementData.length</span><br><span class="line">            &amp;&amp; !(elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span><br><span class="line">                 &amp;&amp; minCapacity &lt;= DEFAULT_CAPACITY)) &#123;</span><br><span class="line">            modCount++;</span><br><span class="line">            grow(minCapacity);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>参考：<a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/collection/ArrayList-Grow.md" target="_blank" rel="noopener">https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/collection/ArrayList-Grow.md</a></p>
<h3 id="与Vector区别"><a href="#与Vector区别" class="headerlink" title="与Vector区别"></a>与Vector区别</h3><ul>
<li>Vector 每次扩容请求其大小的 2 倍空间，而 ArrayList 是 1.5 倍。</li>
<li>Vector是线程安全的</li>
</ul>
<h2 id="Vector-弃用"><a href="#Vector-弃用" class="headerlink" title="Vector(弃用)"></a>Vector(弃用)</h2><p>实现与 ArrayList 类似，但是使用了 synchronized 进行同步,因此开销就比 ArrayList 要大，访问速度更慢。最好使用 ArrayList 而不是 Vector，因为同步操作完全可以由程序员自己来控制；</p>
<h3 id="替代方案1"><a href="#替代方案1" class="headerlink" title="替代方案1"></a>替代方案1</h3><p>使用Collections.synchronizedList(); 得到一个线程安全的 ArrayList。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">List&lt;String&gt; synList = Collections.synchronizedList(list);</span><br></pre></td></tr></table></figure>

<h3 id="替代方案2"><a href="#替代方案2" class="headerlink" title="替代方案2"></a>替代方案2</h3><p>可以使用 java.util.concurrent 并发包下的 CopyOnWriteArrayList 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> CopyOnWriteArrayList&lt;&gt;();</span><br></pre></td></tr></table></figure>

<h2 id="CopyOnWriteArrayList"><a href="#CopyOnWriteArrayList" class="headerlink" title="CopyOnWriteArrayList"></a>CopyOnWriteArrayList</h2><h3 id="读写分离"><a href="#读写分离" class="headerlink" title="读写分离"></a>读写分离</h3><ul>
<li>写操作在一个复制的数组上进行，读操作还是在原始数组中进行，读写分离，互不影响。</li>
<li>写操作需要加锁，防止并发写入时导致写入数据丢失。</li>
<li>写操作结束之后需要把原始数组指向新的复制数组。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line"><span class="keyword">final</span> ReentrantLock lock = <span class="keyword">this</span>.lock;</span><br><span class="line">lock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Object[] elements = getArray();</span><br><span class="line"><span class="keyword">int</span> len = elements.length;</span><br><span class="line">Object[] newElements = Arrays.copyOf(elements, len + <span class="number">1</span>);</span><br><span class="line">newElements[len] = e;</span><br><span class="line">setArray(newElements);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">lock.unlock();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">setArray</span><span class="params">(Object[] a)</span> </span>&#123;</span><br><span class="line">array = a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line"><span class="function"><span class="keyword">private</span> E <span class="title">get</span><span class="params">(Object[] a, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (E) a[index];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h3><p>CopyOnWriteArrayList 在写操作的同时允许读操作，大大提高了读操作的性能，因此很适合<strong>读多写少</strong>的应用场景。<br>但是 CopyOnWriteArrayList 有其缺陷：</p>
<ul>
<li>内存占用：在写操作时需要复制一个新的数组，使得内存占用为原来的两倍左右；</li>
<li>数据不一致：读操作不能读取实时性的数据，因为部分写操作的数据还未同步到读数组中。</li>
</ul>
<p>所以 CopyOnWriteArrayList 不适合内存敏感以及对实时性要求很高的场景。</p>
<h3 id="为什么JUC包里没有并发的ArrayList实现"><a href="#为什么JUC包里没有并发的ArrayList实现" class="headerlink" title="为什么JUC包里没有并发的ArrayList实现"></a>为什么JUC包里没有并发的ArrayList实现</h3><p>主要原因：很难去开发一个通用并且没有并发瓶颈的线程安全的List。</p>
<p>像ConcurrentHashMap这样的类的真正价值并不是它们保证了线程安全。而在于它们在保证线程安全的同时不存在并发瓶颈。举个例子，ConcurrentHashMap采用了锁分段技术和弱一致性的Map迭代器去规避并发瓶颈。</p>
<p>像ArrayList这样的数据结构，你不知道如何去规避并发的瓶颈。拿contains() 这样一个操作来说，当你进行搜索的时候如何避免锁住整个list？</p>
<p>另一方面，Queue和Deque(基于LinkedList)有并发的实现是因为他们的接口相比List的接口有更多的限制，这些限制使得实现并发成为可能。</p>
<p>CopyOnWriteArrayList是一个有趣的例子，它规避了只读操作（如get/contains）并发的瓶颈，但是它为了做到这点，在修改操作中做了很多工作和修改可见性规则。 此外，修改操作还会锁住整个List，因此这也是一个并发瓶颈。所以从理论上来说，CopyOnWriteArrayList并不算是一个通用的并发List。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/22/shell编程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lichord">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lichord">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/22/shell编程/" class="post-title-link" itemprop="url">shell编程简单语法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-22 20:29:51" itemprop="dateCreated datePublished" datetime="2019-07-22T20:29:51+08:00">2019-07-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-09-08 21:41:24" itemprop="dateModified" datetime="2019-09-08T21:41:24+08:00">2019-09-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>shell script:将一堆linux命令集放在一个文件中</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建test.sh文件，输入</span></span><br><span class="line">a=10</span><br><span class="line">b=3</span><br><span class="line">c=`expr <span class="variable">$a</span> + <span class="variable">$b</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$c</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Hello"</span></span><br><span class="line"><span class="comment">#注释用#号</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#表示：定义变量a=10,b=3,expr用于计算表达式，输出c，输出Hello</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#注意：等于号前后不可以有空格，运算符前后必须有空格，输出字符串可以不加""，使用变量的时候要加$符，`不是单引号，而是.md文件插入代码那个符号</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#乘法的话：c=`expr $a * $b`会报语法错，*会被认为是正则表达式，正确写法：c=`expr $a \* $b`使用\转义</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ()也需要转义\ (\)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行shell文件：sh test.sh</span></span><br></pre></td></tr></table></figure>

<h3 id="判断符号"><a href="#判断符号" class="headerlink" title="判断符号"></a>判断符号</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; -gt     //greater than</span><br><span class="line">&lt; -lt        //less than</span><br><span class="line">&lt;= -le     //less equal</span><br><span class="line">&gt;= -ge</span><br><span class="line">= -eq</span><br></pre></td></tr></table></figure>

<h3 id="条件判断："><a href="#条件判断：" class="headerlink" title="条件判断："></a>条件判断：</h3><p>判断a b中的最大值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a=10</span><br><span class="line">b=3</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -gt <span class="variable">$b</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$a</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$b</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h3 id="循环语句："><a href="#循环语句：" class="headerlink" title="循环语句："></a>循环语句：</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> 1 2 3 4 5 6 7 8 9</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$x</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">x=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$x</span> -le 10 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$x</span></span><br><span class="line">        x=`expr <span class="variable">$x</span> + 1`</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="字符串："><a href="#字符串：" class="headerlink" title="字符串："></a>字符串：</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="string">"hello"</span></span><br><span class="line">b=<span class="string">"world"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span> <span class="variable">$b</span></span><br><span class="line"><span class="comment">#输出为hello world 空格也被输出</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#输入a b</span></span><br><span class="line"><span class="built_in">read</span> a</span><br><span class="line"><span class="built_in">read</span> b</span><br><span class="line">c=`expr <span class="variable">$a</span> + <span class="variable">$b</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span> + <span class="variable">$b</span> = <span class="variable">$c</span></span><br><span class="line"><span class="comment">#控制台输入1 2 ，输出则为1 + 2 = 3</span></span><br></pre></td></tr></table></figure>

<p>比较字符串用一个等于号就行<br>不等用!=</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">password=<span class="string">"hello123"</span></span><br><span class="line"><span class="built_in">read</span> user</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$user</span> = <span class="variable">$password</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">       <span class="built_in">echo</span> <span class="string">"密码正确"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">       <span class="built_in">echo</span> 密码错误</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h4 id="字符串拼接："><a href="#字符串拼接：" class="headerlink" title="字符串拼接："></a>字符串拼接：</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">str1=<span class="string">"hello"</span></span><br><span class="line">str2=<span class="string">"world"</span></span><br><span class="line">str3=<span class="string">"<span class="variable">$str1</span> + <span class="variable">$str2</span>"</span></span><br></pre></td></tr></table></figure>

<p>判断字符串是否长度为0:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -z zero    是0</span></span><br><span class="line"><span class="comment"># -n not zero   不是0</span></span><br><span class="line">str1=<span class="string">""</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$str1</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">       <span class="built_in">echo</span> <span class="string">"字符串长度为0"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"字符串长度不为0"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h3 id="数组："><a href="#数组：" class="headerlink" title="数组："></a>数组：</h3><p>传统shell脚本不支持数组，但bash可以运行数组</p>
<p>执行命令:bash test.sh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">arr=(7 8 9 10)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$arr</span></span><br><span class="line"><span class="comment">#输出arr下标为0的内容</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;arr[1]&#125;</span></span><br><span class="line"><span class="comment">#输出arr下标为1的内容</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;arr[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在命令行中：</span></span><br><span class="line"><span class="comment">#输出用户：</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$USER</span></span><br><span class="line"><span class="comment">#输出用户主目录</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$HOME</span></span><br><span class="line"><span class="comment">#输出环境变量</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>

<h4 id="添加环境变量"><a href="#添加环境变量" class="headerlink" title="添加环境变量"></a>添加环境变量</h4><p>Linux下的环境变量用:分开，不同于windows<br>创建一个c程序</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim example.c</span><br><span class="line">gcc example.c -o example</span><br><span class="line">./example</span><br></pre></td></tr></table></figure>

<p>要想在其他文件夹下也可以执行这个文件，就需要将example所在目录设置为全局变量<br>在原来的PATH下增加新变量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PATH~<span class="variable">$PATH</span>:/home/ubuntu/workspace</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/22/linux常用命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lichord">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lichord">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/22/linux常用命令/" class="post-title-link" itemprop="url">linux常用命令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-22 19:29:51" itemprop="dateCreated datePublished" datetime="2019-07-22T19:29:51+08:00">2019-07-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-09-11 17:59:30" itemprop="dateModified" datetime="2019-09-11T17:59:30+08:00">2019-09-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>cal 12 2019 日历</li>
<li>pwd 显示当前所在文件夹</li>
<li>cd / 切换到根目录 也可以切换到别的目录</li>
<li>cd .. 退回到下一个文件夹</li>
<li>cd 切换到用户主目录</li>
<li>ls 当前文件夹下面有什么文件</li>
<li>ls -l 当前文件夹下面文件极其详细信息</li>
<li>clear清空屏幕</li>
<li>mkdir hello创建一个名为hello的文件夹</li>
<li>mkdir -p dir1/dir2/dir3/ 使用-p选项可以创建一个路径上所有不存在的目录</li>
<li>rmdir hello/ 移除文件夹</li>
<li>cp a.txt file.txt 复制a.txt 再生成file.txt</li>
<li>cat sym.txt 查看文件所有内容</li>
<li>less sym.txt文件太长的时候可以翻页查看，点击q退出这个查看模式</li>
<li>diff sym.txt file2.txt 查看两个文件的不同的地方</li>
<li>head sum.txt -n 6  看文件前面6行</li>
<li>tail sum.txt -n 6  看文件最后面6行</li>
<li>wc sym.txt<ul>
<li>输出：178 225 1836 sym.txt</li>
<li>表示：sym.txt文件一共178行，有225个单词，1836个字节</li>
</ul>
</li>
<li>wc -w sym.txt 看有多少个单词</li>
<li>wc -l sym.txt 看有多少行</li>
<li>wc -c sym.txt 看有多少字节</li>
<li>rm file2.txt 删除文件(慎用)</li>
<li>mv file1.txt a.txt 将file1.txt改名成a.txt</li>
<li>mv hi.txt bye/将hi.txt移动到bye文件夹下</li>
<li>zip program.zip * 将文件夹下所有文件压缩成program.zip</li>
<li>zip workspace.zip -r workspace/*把workspace下所有东西做成压缩包，-r表示把文件夹的子文件夹也一层一层打包</li>
<li>tar -zcvf file.tar.gz wo/ 压缩wo文件夹</li>
<li>tar -zxvf file.tar.gz 解压</li>
<li>tar -tvf file.tar 查看tar文件</li>
<li>unzip workspace.zip</li>
</ul>
<h3 id="wget-下载文件"><a href="#wget-下载文件" class="headerlink" title="wget 下载文件"></a>wget 下载文件</h3><ul>
<li>wget 网址 //下载这个网址的内容</li>
<li>wget 网址 -O newname.tar.gz//下载这个网址的文件并重命名<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://prdownloads.sourceforge.net/sourceforge/nagios/nagios-3.2.1.tar.gz</span><br><span class="line"></span><br><span class="line">$ wget -O taglist.zip http://www.vim.org/scripts/download_script.php?src_id=7701</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="ping-ping一个远程主机，只发5个数据包"><a href="#ping-ping一个远程主机，只发5个数据包" class="headerlink" title="ping ping一个远程主机，只发5个数据包"></a>ping ping一个远程主机，只发5个数据包</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ping -c 5 gmail.com</span><br></pre></td></tr></table></figure>

<h3 id="ifconfig-用于查看和配置Linux系统的网络接口"><a href="#ifconfig-用于查看和配置Linux系统的网络接口" class="headerlink" title="ifconfig 用于查看和配置Linux系统的网络接口"></a>ifconfig 用于查看和配置Linux系统的网络接口</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看所有网络接口及其状态</span></span><br><span class="line">$ ifconfig -a</span><br><span class="line"><span class="comment">#使用up和down命令启动或停止某个接口</span></span><br><span class="line">$ ifconfig eth0 up</span><br><span class="line">$ ifconfig eth0 down</span><br></pre></td></tr></table></figure>

<h3 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">netstat 查看网络连接情况</span><br><span class="line">netstat -i 显示网卡运行情况</span><br><span class="line">netstat -r 查看主句的路由列表</span><br><span class="line"></span><br><span class="line">netstat -an 查看当前系统端口使用情况</span><br></pre></td></tr></table></figure>

<h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#重启网卡</span></span><br><span class="line">service network restart</span><br><span class="line"><span class="comment"># 关闭网卡</span></span><br><span class="line">ifdown eth0</span><br><span class="line"><span class="comment">#开启网卡</span></span><br><span class="line">ifup eth0</span><br></pre></td></tr></table></figure>

<h3 id="hostname"><a href="#hostname" class="headerlink" title="hostname"></a>hostname</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hostname 显示主机名</span><br><span class="line">hostname -i 显示当前主机名的IP</span><br></pre></td></tr></table></figure>

<h3 id="ps命令用于显示正在运行中的进程的信息"><a href="#ps命令用于显示正在运行中的进程的信息" class="headerlink" title="ps命令用于显示正在运行中的进程的信息"></a>ps命令用于显示正在运行中的进程的信息</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">查看当前正在运行的所有进程</span><br><span class="line"></span><br><span class="line">$ ps -ef | more</span><br><span class="line">以树状结构显示当前正在运行的进程，H选项表示显示进程的层次结构</span><br><span class="line">$ ps -efH | more</span><br><span class="line"></span><br><span class="line">ps aux|grep java </span><br><span class="line"><span class="comment">#查看java进程</span></span><br><span class="line"></span><br><span class="line">ps aux </span><br><span class="line"><span class="comment">#查看所有进程</span></span><br></pre></td></tr></table></figure>

<h3 id="kill-终止进程"><a href="#kill-终止进程" class="headerlink" title="kill 终止进程"></a>kill 终止进程</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#kill用于终止一个进程。一般我们会先用ps -ef查找某个进程得到它的进程号，然后再使用kill -9 进程号终止该进程。你还可以使用killall、pkill、xkill来终止进程</span></span><br><span class="line"></span><br><span class="line">$ ps -ef | grep vim</span><br><span class="line">ramesh    7243  7222  9 22:43 pts/2    00:00:00 vim</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">kill</span> -9 7243</span><br></pre></td></tr></table></figure>

<h3 id="date-显示时间"><a href="#date-显示时间" class="headerlink" title="date 显示时间"></a>date 显示时间</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改系统日期</span></span><br><span class="line">date -s <span class="string">"01/31/2010 23:59:53"</span></span><br></pre></td></tr></table></figure>

<h3 id="chmod权限管理："><a href="#chmod权限管理：" class="headerlink" title="chmod权限管理："></a>chmod权限管理：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">linux下的三种不同用户，分别是u,g,o代表作者，小组，其他人；每种用户的权限都有三种r,w,x，分别是可读可写运行</span><br><span class="line"></span><br><span class="line">ls  -l查看文件或者文件夹的详情时</span><br><span class="line">输出：-rm-r--r-- </span><br><span class="line">-开头表示这是文件，d开头的话表示是目录，用户可读可写，小组成员其他人可读</span><br></pre></td></tr></table></figure>

<ul>
<li>chmod  u-r hello.txt将作者的权限减去可读</li>
<li>chmod u+r hello.txt为作者增加可读权限</li>
<li>chmod go-r 小组，其他人都不可读<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">权限可以用二进制表示，1有权限，0无权限</span><br><span class="line"></span><br><span class="line">r w x</span><br><span class="line"></span><br><span class="line">1 1 0</span><br><span class="line"></span><br><span class="line">可读可写不可运行，十进制等于6</span><br><span class="line"></span><br><span class="line">chmod 644 hello.txt 作者可读可写，小组，其他人可读</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="grep-结合正则表达式在文件中查找字符串"><a href="#grep-结合正则表达式在文件中查找字符串" class="headerlink" title="grep 结合正则表达式在文件中查找字符串"></a>grep 结合正则表达式在文件中查找字符串</h3><ul>
<li><code>grep en hello.txt</code> 显示hello.txt里面包含en这个字符串的所有单词。en这个位置可以用其他正则表达式代替</li>
<li><code>grep l* hello.txt</code>查找所有l出现0-n次的单词</li>
<li><code>grep ll* hello.txt</code>查找所有l出现1-n次的单词</li>
<li><code>grep ^H hello.txt</code>查找以H开头的单词</li>
<li><code>grep H.ll hello.txt</code> .表示任意字母</li>
<li><code>grep [Hh].ll hello.txt</code> []里面的H,h任选一个</li>
<li><code>grep [A-Za-z]ill hello.txt</code> 任意字母</li>
<li><code>grep [A-Za-z]ill hello.txt | wc</code> 把输出的所有内容放在wc中进行统计<ul>
<li>输出：19 29 224</li>
<li>表示：19行，29个单词，224字符</li>
</ul>
</li>
</ul>
<h3 id="find"><a href="#find" class="headerlink" title="find"></a>find</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查找指定文件名的文件(不区分大小写)</span></span><br><span class="line"></span><br><span class="line">$ find -iname <span class="string">"MyProgram.c"</span></span><br><span class="line"><span class="comment">#对找到的文件执行某个命令</span></span><br><span class="line"></span><br><span class="line">$ find -iname <span class="string">"MyProgram.c"</span> -<span class="built_in">exec</span> md5sum &#123;&#125; \;</span><br><span class="line"><span class="comment">#查找home目录下的所有空文件</span></span><br><span class="line"></span><br><span class="line">$ find ~ -empty</span><br></pre></td></tr></table></figure>

<h3 id="export-输出跟字符串oracle匹配的环境变量"><a href="#export-输出跟字符串oracle匹配的环境变量" class="headerlink" title="export 输出跟字符串oracle匹配的环境变量"></a>export 输出跟字符串oracle匹配的环境变量</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> | grep ORCALE</span><br><span class="line"><span class="built_in">declare</span> -x ORACLE_BASE=<span class="string">"/u01/app/oracle"</span></span><br><span class="line"><span class="built_in">declare</span> -x ORACLE_HOME=<span class="string">"/u01/app/oracle/product/10.2.0"</span></span><br><span class="line"><span class="built_in">declare</span> -x ORACLE_SID=<span class="string">"med"</span></span><br><span class="line"><span class="built_in">declare</span> -x ORACLE_TERM=<span class="string">"xterm"</span></span><br><span class="line"><span class="comment">#设置全局环境变量</span></span><br><span class="line">$ <span class="built_in">export</span> ORACLE_HOME=/u01/app/oracle/product/10.2.0</span><br></pre></td></tr></table></figure>

<h3 id="重定向符号-gt"><a href="#重定向符号-gt" class="headerlink" title="重定向符号 &gt;"></a>重定向符号 &gt;</h3><p><code>ls &gt; 1.txt</code></p>
<p>将本来会在shell输出的内容，就是当前文件夹下的文件信息，放在1.txt文件中</p>
<h3 id="whatis-显示某个命令的描述信息"><a href="#whatis-显示某个命令的描述信息" class="headerlink" title="whatis 显示某个命令的描述信息"></a>whatis 显示某个命令的描述信息</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ whatis ls</span><br><span class="line">ls		(1)  - list directory contents</span><br></pre></td></tr></table></figure>

<h3 id="whereis"><a href="#whereis" class="headerlink" title="whereis"></a>whereis</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#当你不知道某个命令的位置时可以使用whereis命令，下面使用whereis查找ls的位置</span></span><br><span class="line">$ whereis ls</span><br><span class="line">ls: /bin/ls /usr/share/man/man1/ls.1.gz /usr/share/man/man1p/ls.1p.gz</span><br><span class="line"><span class="comment">#当你想查找某个可执行程序的位置，但这个程序又不在whereis的默认目录下，你可以使用-B选项，并指定目录作为这个选项的参数。下面的命令在/tmp目录下查找lsmk命令</span></span><br><span class="line">$ whereis -u -B /tmp -f lsmk</span><br><span class="line">lsmk: /tmp/lsmk</span><br></pre></td></tr></table></figure>

<h3 id="uname"><a href="#uname" class="headerlink" title="uname"></a>uname</h3><p>uname可以显示一些重要的系统信息，例如内核名称、主机名、内核版本号、处理器类型之类的信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ uname -a</span><br><span class="line">Linux john-laptop 2.6.32-24-generic<span class="comment"># 41-Ubuntu SMP Thu Aug 19 01:12:52 UTC 2010 i686 GNU/Linux</span></span><br></pre></td></tr></table></figure>

<h3 id="vim编辑器"><a href="#vim编辑器" class="headerlink" title="vim编辑器"></a>vim编辑器</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yy 复制一行数据</span><br><span class="line"><span class="keyword">pp</span> 粘贴</span><br><span class="line">dd 剪切</span><br></pre></td></tr></table></figure>

<h3 id="rpm安装软件包"><a href="#rpm安装软件包" class="headerlink" title="rpm安装软件包"></a>rpm安装软件包</h3><h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#连接一个远程数据库，需要输入密码</span></span><br><span class="line">$ mysql -u root -p -h 192.168.1.2</span><br><span class="line"><span class="comment">#连接本地数据库</span></span><br><span class="line">$ mysql -u root -p</span><br></pre></td></tr></table></figure>

<p><a href="http://gywbd.github.io/posts/2014/8/50-linux-commands.html" target="_blank" rel="noopener">http://gywbd.github.io/posts/2014/8/50-linux-commands.html</a></p>
<p><a href="https://blog.csdn.net/bieleyang/article/details/76665022" target="_blank" rel="noopener">https://blog.csdn.net/bieleyang/article/details/76665022</a></p>
<p><a href="https://www.hollischuang.com/archives/800" target="_blank" rel="noopener">https://www.hollischuang.com/archives/800</a></p>
<p><a href="https://segmentfault.com/a/1190000015497396" target="_blank" rel="noopener">https://segmentfault.com/a/1190000015497396</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/20/JVM内存管理机制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lichord">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lichord">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/20/JVM内存管理机制/" class="post-title-link" itemprop="url">JVM内存管理机制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-20 20:29:51" itemprop="dateCreated datePublished" datetime="2019-07-20T20:29:51+08:00">2019-07-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-26 09:25:57" itemprop="dateModified" datetime="2019-10-26T09:25:57+08:00">2019-10-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="一-类加载器"><a href="#一-类加载器" class="headerlink" title="一.类加载器"></a>一.类加载器</h3><p>虚拟机设计团队把类加载阶段中的“通过一个类的全限定名来获取描述此类的二进制字节流”这个动作放到Java虚拟机外部去实现，以便让应用程序自己决定如何去获取所需要的类。实现这个动作的代码模块<br>称为“类加载器”。<br><img src="https://i.loli.net/2019/08/21/ryLpSeuxtmZoP2s.jpg" alt="类加载子系统.png"></p>
<p>类加载生命周期七阶段：</p>
<ul>
<li>类加载：类加载器将class文件加载到虚拟机的内存</li>
<li>加载：在硬盘上查找并通过IO读入字节码文件</li>
<li>连接：执行校验，准备，解析（可选）步骤</li>
<li>校验：校验字节码文件的正确性</li>
<li>准备：给类的静态变量分配内存，并赋予默认值</li>
<li>解析：类加载器装入类所引用的其他类</li>
<li>初始化：对类的静态变量初始化为指定的值，执行静态代码块<h4 id="类与类加载器"><a href="#类与类加载器" class="headerlink" title="类与类加载器"></a>类与类加载器</h4></li>
<li>对于任意一个类，都需要由加载它的类加载器和这个类本身一同确立其在Java虚拟机中的唯一性，每一个类加载器，都拥有一个独立的类名称空间。即使两个类来源于同一个Class文件，被同一个虚拟机加载，只要加载它们的类加载器不同，那这两个类就必定不相等。<h4 id="常见加载器"><a href="#常见加载器" class="headerlink" title="常见加载器"></a>常见加载器</h4>从Java虚拟机的角度来讲，只存在两种不同的类加载器：一种是启动类加载器（Bootstrap ClassLoader），是虚拟机自身的一部分；另一种就是所有其他的类加载器，这些类加载器都由Java语言实现，独立于虚拟机外部，并且全都继承自抽象类<br>java.lang.ClassLoader。</li>
</ul>
<p>从java开发人员角度，类加载器可以分为三类：</p>
<ul>
<li>启动类加载器：Bootstrap ClassLoader，C++语言实现，负责加载JDK中的核心类库。这个类加载器负责将存放＜JAVA_HOME＞\lib目录中的，或者被-Xbootclasspath参数所指定的路径中的，并且是虚拟机识别的（仅按照文件名识别，如rt.jar，名字不符合的类库即使放在lib目录中也不会被加载）类库加载到虚拟机内存中。启动类加载器无法被Java程序直接引用，用户在编写自定义类加载器时，如果需要把加载请求委派给引导类加载器，那直接使用null代替即可</li>
<li>扩展类加载器：Extension ClassLoader,java实现，负责加载JDK\jre\lib\ext目录，或者由java.ext.dirs系统变量指定路径中的所有类库（如javax.*开头的类），开发者可以直接使用扩展类加载器</li>
<li>应用程序类加载器 Application ClassLoader，负责加载应用程序classpath目录下的所有jar和class文件。开发者可以直接使用该类加载器。</li>
</ul>
<p>除了Java默认提供的三个ClassLoader之外，用户还可以根据需要定义自已的ClassLoader，而这些自定义的ClassLoader都必须继承自java.lang.ClassLoader类，也包括Java提供的另外二个ClassLoader（Extension ClassLoader和App ClassLoader）在内，但是Bootstrap ClassLoader不继承自ClassLoader，因为它不是一个普通的Java类，底层由C++编写，已嵌入到了JVM内核当中，当JVM启动后，Bootstrap ClassLoader也随着启动，负责加载完核心类库后，并构造Extension ClassLoader和App ClassLoader类加载器</p>
<h4 id="双亲委托模型"><a href="#双亲委托模型" class="headerlink" title="双亲委托模型"></a>双亲委托模型</h4><p>双亲委派模型要求除了顶层的启动类加载器外，其余的类加载器都应当有自己的父类加载器<br><img src="https://i.loli.net/2019/08/21/wHPonQv91lbFShC.png" alt="20190506_5cd066188b4ea.png"></p>
<h5 id="工作过程"><a href="#工作过程" class="headerlink" title="工作过程"></a>工作过程</h5><p>如果一个类加载器收到了类加载的请<br>求，它首先不会自己去尝试加载这个类，而是把这个请求委派给父类加载器去完成，每一个层次的类加载器都是如此，因此所有的加载请求最终都应该传送到顶层的启动类加载器中，只有当父加载器反馈自己无法完成这个加载请求（它的搜索范围中没有找到所需的类）时，子加载器才会尝试自己去加载。如果没有找到，会抛出ClassNotFoundException。</p>
<h5 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h5><p>避免重复加载，保证Java程序的稳定运作。Java类随着它的类加载器一起具备了一种带有优先级的层次关系。例如类java.lang.Object，它存放在rt.jar之中，无论哪一个类加载器要加载这个类，最终都是委派给处于模型最顶端的启动类加载器进行加载，因此Object类在程序的各种类加载器环境中都是同一个类。如果不使用这种委托模式，那我们就可以随时使用自定义的Object来动态替代java核心api中定义的类型，这样会存在非常大的安全隐患，而双亲委托的方式，就可以避免这种情况</p>
<h4 id="自定义classLoader"><a href="#自定义classLoader" class="headerlink" title="自定义classLoader"></a>自定义classLoader</h4><h5 id="为什么要自定义类加载器"><a href="#为什么要自定义类加载器" class="headerlink" title="为什么要自定义类加载器"></a>为什么要自定义类加载器</h5><p>Java中提供的默认ClassLoader，只加载指定目录下的jar和class，如果我们想加载其它位置的类或jar时，比如：我要加载网络上的一个class文件，通过动态加载到内存之后，要调用这个类中的方法实现我的业务逻辑。在这样的情况下，默认的ClassLoader就不能满足我们的需求了，所以需要定义自己的ClassLoader</p>
<h5 id="怎么定义"><a href="#怎么定义" class="headerlink" title="怎么定义"></a>怎么定义</h5><ol>
<li>继承java.lang.ClassLoader</li>
<li>重写父类的findClass方法</li>
</ol>
<p>父类有那么多方法，为什么偏偏只重写findClass方法？</p>
<ul>
<li>因为JDK已经在loadClass方法中帮我们实现了ClassLoader搜索类的算法，当在loadClass方法中搜索不到类时，loadClass方法就会调用findClass方法来搜索类，所以我们只需重写该方法即可。如没有特殊的要求，一般不建议重写loadClass搜索类的算法。下图是API中ClassLoader的loadClass方法：<br><img src="https://i.loli.net/2019/08/23/OJPUeo3BRXri67q.jpg" alt="0_1330186866b93o.gif"><h3 id="二-运行时数据区"><a href="#二-运行时数据区" class="headerlink" title="二. 运行时数据区"></a>二. 运行时数据区</h3>线程独占区的虚拟机栈，本地方法栈，程序计数器都随线程的生死而生死<br><img src="https://i.loli.net/2019/08/21/ecRLpdh8Ha79NBZ.jpg" alt="f620089148f9f1061ff2db8a725048f5.png"><h4 id="1-虚拟机栈"><a href="#1-虚拟机栈" class="headerlink" title="1. 虚拟机栈"></a>1. 虚拟机栈</h4>java线程执行方法的内存模型，一个线程对应一个栈，栈的生命周期与线程相同。每个方法在执行的同时都会创建一个栈帧（用于存储局部变量表，操作数栈，动态链接，方法出口等信息）不存在垃圾回收问题，只要线程一结束该栈就释放<br><img src="https://i.loli.net/2019/08/21/71D9UncIZ6gmsWB.jpg" alt="fdaf4c58a254103c4730d7ab13f5b602.jpeg"><br>虚拟机栈规定了两种异常</li>
<li>如果线程请求的栈深度大于虚拟机所允许的深度，抛出StackOverflowError异常</li>
<li>如果虚拟机栈可以动态扩展，当扩展时无法申请到足够的内存，就会抛出OutOfMemoryError异常<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> b=<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> c=(a+b)*<span class="number">100</span>;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main String[]args)&#123;</span><br><span class="line">        App app=<span class="keyword">new</span> App();</span><br><span class="line">        <span class="keyword">int</span> result=app.add();</span><br><span class="line">        System.out.plintln(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><img src="https://i.loli.net/2019/08/21/hboJnAQ3DNS1qOP.png" alt="虚拟机栈.png"><br>局部变量表存放编译时期可知的各种基本数据类型（boolean,byte,char,short,int,float,long,double),对象引用（存放指针），和returnAdddress类型（指向一条字节码指令的地址）</p>
<p>局部变量表所需内存空间在编译期间完成分配，在方法运行期间不会改变局部变量表的大小。</p>
<p>64位的long,double会占用2个局部变量空间，其余数据类型只占一个</p>
<p>Java 栈中保存的主要内容是栈帧，每一次函数调用都会有一个对应的栈帧被压入 Java 栈，每一个函数调用结束后，都会有一个栈帧被弹出。</p>
<p>Java 方法有两种返回方式：</p>
<ul>
<li>return 语句。</li>
<li>抛出异常。<br>不管哪种返回方式都会导致栈帧被弹出。</li>
</ul>
<h4 id="2-本地方法栈"><a href="#2-本地方法栈" class="headerlink" title="2. 本地方法栈"></a>2. 本地方法栈</h4><p>结构与虚拟机栈一致，也会抛出StackOverflowError和OutOfMemoryError。本地方法栈的方法都是有native关键字修饰的。区别只是虚拟机栈为执行java方法（字节码）服务，本地方法栈为虚拟机使用到的Native方法服务。（使用native关键字说明这个方法是原生函数，也就是这个方法是用C/C++语言实现的，并且被编译成了DLL，由java去调用。）</p>
<p>本地方法栈登记native方法，在Execution Engine执行时加载本地方法库</p>
<h4 id="3-程序计数器"><a href="#3-程序计数器" class="headerlink" title="3. 程序计数器"></a>3. 程序计数器</h4><p>一个指针，存储下一个指令的地址，是一个非常小的内存空间。由执行引擎读取下一条指令</p>
<p>在任何确定的时刻，一个内核都只会处理一条线程的指令，为了线程切换后能恢复到正确的执行位置，每条线程都需要有一个独立的程序计数器，各条线程之间计数器互不影响，独立存储，这是线程私有的内存。</p>
<p>如果线程执行java方法，这个计数器记录的是正在执行的虚拟机字节码指令的地址，如果正在执行native方法，这个计数器值则为空（Undefined）。</p>
<p>程序计数器是唯一一个在java虚拟机规范中没有规定任何OutOfMemoryError的内存区域</p>
<h4 id="4-方法区（线程共享）-非堆"><a href="#4-方法区（线程共享）-非堆" class="headerlink" title="4. 方法区（线程共享）/非堆"></a>4. 方法区（线程共享）/非堆</h4><p>存储已被虚拟机加载的静态变量+常量+类信息+即时编译器编译后的代码等数据，类的所有字段和方法字节码，以及一些特殊方法如构造函数，接口代码也在此定义。</p>
<p>java虚拟机规范把方法区描述为堆的一个逻辑部分，但是方法区有个别名叫non-heap与堆区分开</p>
<p>方法区可以选择不实现垃圾收集器。这区域的回收目标是针对常量池的回收和对类型的卸载</p>
<h5 id="运行时常量池"><a href="#运行时常量池" class="headerlink" title="运行时常量池"></a>运行时常量池</h5><p>运行时常量池是方法区的一部分，用于存放编译器生成的各种字面量和符号引用。</p>
<h4 id="5-堆"><a href="#5-堆" class="headerlink" title="5. 堆"></a>5. 堆</h4><p>虚拟机启动时自动创建，用于存放对象实例，几乎所有对象实例以及数组都在堆上分配内存。java堆只要逻辑上连续即可，可以物理不连续</p>
<p>当对象无法在该空间申请到内存，堆也无法扩展时抛出OutOfMemoryError异常</p>
<p>是垃圾收集器管理的主要区域。</p>
<p>可通过-Xmx -Xms参数来分别指定最大堆，最小堆</p>
<p>Java堆还可以细分为：新生代和老年代。新生代再细致一点有：Eden 空间、From Survivor、To Survivor 空间等。进一步划分的目的是更好地回收内存，或者更快地分配内存。</p>
<p>eden 区、s0 区、s1 区都属于新生代，tentired 区属于老年代。大部分情况，对象都会首先在 Eden 区域分配，在一次新生代垃圾回收后，如果对象还存活，则会进入 s0 或者 s1，并且对象的年龄还会加 1(Eden 区-&gt;Survivor 区后对象的初始年龄变为 1)，当它的年龄增加到一定程度（默认为 15 岁），就会被晋升到老年代中。对象晋升到老年代的年龄阈值，可以通过参数 <code>-XX:MaxTenuringThreshold</code> 来设置。</p>
<p>从内存分配的角度看，线程共享的java堆可能划分出多个线程私有的分配缓冲区<br><img src="https://i.loli.net/2019/08/21/Lphk5ys2lSqcACX.png" alt="堆.png"></p>
<h4 id="直接内存"><a href="#直接内存" class="headerlink" title="直接内存"></a>直接内存</h4><p>直接内存不是虚拟机运行时数据区的一部分，也不是java虚拟机规范中定义的内存区域，但是这部分内存也被频繁使用，也可能出现OutOfMemoryError</p>
<p>JDK1.4加入NIO（new input/ouput)类，引入了一种基于通道和缓存区的I/O方式，它可以使用native函数库直接分配堆外内存，然后通过一个存储在java堆中的DirectByteBuffer对象作为这块内存的引用进行操作。这样能在一些场景显著提高性能，因为避免了在java堆和native堆中来回复制数据</p>
<h3 id="三-HotSpot虚拟机对象揭秘"><a href="#三-HotSpot虚拟机对象揭秘" class="headerlink" title="三. HotSpot虚拟机对象揭秘"></a>三. HotSpot虚拟机对象揭秘</h3><h4 id="对象的创建"><a href="#对象的创建" class="headerlink" title="对象的创建"></a>对象的创建</h4><ul>
<li><p>虚拟机遇到一条new指令时，首先将去检查这个指令的参数是否能在常量池中定位到一个类的符号引用，并且检查这个符号引用代表的类是否已被加载、解析和初始化过。如果没有，那必须先执行相应的类加载过程</p>
</li>
<li><p>在类加载检查通过后，接下来虚拟机将为新生对象分配内存。对象<br>所需内存的大小在类加载完成后便可完全确定<br><img src="https://i.loli.net/2019/08/22/IePouqwTQhYmL7k.png" alt="jvm_create.png"></p>
</li>
<li><p>为对象分配空间的任务等同于把一块确定大小的内存从Java堆中划分出来。假设Java堆中内存是绝对规整的，所有用过的内存都放在一边，空闲的内存放在另一边，中间放着一个指针作为分界点的指示器，那所分配内存就仅仅是把那个指针向空闲空间那边挪动一段与对象大小相等的距离，这种分配方式称为“指针碰撞”（Bump the Pointer）。</p>
</li>
<li><p>如果Java堆中的内存并不是规整的，已使用的内存和空闲的内存相互交错，那就没有办法简单地进行指针碰撞了，虚拟机就必须维护一个列表，记录上哪些内存块是可用的，在分配的时候从列表中找到一块足够大的空间划分给对象实例，并更新列表上的记录，这种分配方式称为“空闲列表”（Free List）。</p>
</li>
<li><p>选择哪种分配方式由Java堆是否规整决<br>定，而Java堆是否规整又由所采用的垃圾收集器是否带有压缩整理功能决定。因此，在使用Serial、ParNew等带Compact过程的收集器时，系统采用的分配算法是指针撞，而使用CMS这种基于Mark-Sweep算法的收集器时，通常采用空闲列表。</p>
</li>
<li><p>对象创建在虚拟机中是非常频繁的行为，即使是仅仅修改一个指针所指向的位置，在并发情况下也并不是线程安全的。解决这个问题有两种方案，一种是<strong>对分配内存空间的动作进行同步处理</strong>——实际上虚拟机采用CAS配上失败重试的方式保证更新操作的原子性；另一种是<strong>把内存分配的动作按照线程划分在不同的空间之中进行</strong>，即每个线程在Java堆中预先分配一小块内存，称为<strong>本地线程分配缓冲</strong>（Thread Local Allocation Buffer,TLAB）。哪个线程要分配内存，就在哪个线程的TLAB上分配，只有TLAB用完并分配新的TLAB时，才需要同步锁定。虚拟机是否使用TLAB，可以通过-XX:+/-UseTLAB参数来设定。</p>
</li>
<li><p>内存分配完成后，虚拟机需要将分配到的内存空间都初始化为零值（不包括对象头），如果使用TLAB，这一工作过程也可以提前至TLAB分配时进行。这一步操作保证了对象的实例字段在Java代码中可以不赋初始值就直接使用，程序能访问到这些字段的数据类型所对应的零值。</p>
</li>
<li><p>接下来，虚拟机要对对象进行必要的设置，例如这个对象是哪个类<br>的实例、如何才能找到类的元数据信息、对象的哈希码、对象的GC分代年龄等信息。这些信息存放在对象的对象头（Object Header）之中。根据虚拟机当前的运行状态的不同，如是否启用偏向锁等，对象头会有不同的设置方式。</p>
</li>
<li><p>在上面工作都完成之后，从虚拟机的视角来看，一个新的对象已经产生了，但从Java程序的视角来看，对象创建才刚刚开始——＜init＞方法还没有执行，所有的字段都还为零。所以，一般来说（由字节码中是否跟随invokespecial指令所决定），执行new指令之后会接着执行＜init＞方法，把对象按照程序员的意愿进行初始化，这样一个真正可用的对<br>象才算完全产生出来。</p>
<h4 id="对象的内存布局"><a href="#对象的内存布局" class="headerlink" title="对象的内存布局"></a>对象的内存布局</h4></li>
<li><p>在HotSpot虚拟机中，对象在内存中存储的布局可以分为3块区域：对象头（Header）、实例数据（Instance Data）和对齐填充（Padding）。</p>
<h5 id="对象头"><a href="#对象头" class="headerlink" title="对象头"></a>对象头</h5><p>HotSpot虚拟机的对象头包括两部分信息</p>
</li>
<li><p>第一部分用于存储对象自身的运行时数据，如哈希码（HashCode）、GC分代年龄、锁状态标志、线程持有的锁、偏向线程ID、偏向时间戳等，这部分数据的长度在32位和64位的虚拟机（未开启压缩指针）中分别为32bit和64bit，官方称它为”Mark Word”。对象需要存储的运行时数据很多，其实已经超出了<br>32位、64位Bitmap结构所能记录的限度，但是对象头信息是与对象自身定义的数据无关的额外存储成本，考虑到虚拟机的空间效率，MarkWord被设计成一个非固定的数据结构以便在极小的空间内存储尽量多的信息，它会根据对象的状态复用自己的存储空间。例如，在32位的HotSpot虚拟机中，如果对象处于未被锁定的状态下，那么Mark Word的<br>32bit空间中的25bit用于存储对象哈希码，4bit用于存储对象分代年龄，2bit用于存储锁标志位，1bit固定为0，而在其他状态（轻量级锁定、重量级锁定、GC标记、可偏向）下对象的存储内容见表</p>
</li>
</ul>
<p><img src="https://i.loli.net/2019/08/22/e715nxwStsTuajh.png" alt="1548563345042.png"></p>
<ul>
<li>对象头的另外一部分是类型指针，即对象指向它的类元数据的指针，虚拟机通过这个指针来确定这个对象是哪个类的实例。并不是所有的虚拟机实现都必须在对象数据上保留类型指针，换句话说，查找对象的元数据信息并不一定要经过对象本身。另外，如果对象是一个Java数组，那在对象头中还必须有一块用于记录数组长度的数据，因为虚拟机可以通过普通Java对象的元数据信息确定Java对象的大小，但是从数组的元数据中却无法确定数组的大小。<h5 id="实例数据部分"><a href="#实例数据部分" class="headerlink" title="实例数据部分"></a>实例数据部分</h5>是对象真正存储的有效信息，也是在程序代<br>码中所定义的各种类型的字段内容。无论是从父类继承下来的，还是在子类中定义的，都需要记录起来。这部分的存储顺序会受到虚拟机分配策略参（FieldsAllocationStyle）和字段在Java源码中定义顺序的影响。HotSpot虚拟机默认的分配策略为longs/doubles、ints、shorts/chars、<br>bytes/booleans、oops（Ordinary Object Pointers），从分配策略中可以看出，相同宽度的字段总是被分配到一起。在满足这个前提条件的情况下，在父类中定义的变量会出现在子类之前。如果CompactFields参数值为true（默认为true），那么子类之中较窄的变量也可能会插入到父类变<br>量的空隙之中。<h5 id="对齐填充"><a href="#对齐填充" class="headerlink" title="对齐填充"></a>对齐填充</h5>并不是必然存在的，也没有特别的含义，它仅仅<br>起着占位符的作用。由于HotSpot VM的自动内存管理系统要求对象起始地址必须是8字节的整数倍，换句话说，就是对象的大小必须是8字节的整数倍。而对象头部分正好是8字节的倍数（1倍或者2倍），因此，当对象实例数据部分没有对齐时，就需要通过对齐填充来补全。</li>
</ul>
<h4 id="对象的访问"><a href="#对象的访问" class="headerlink" title="对象的访问"></a>对象的访问</h4><p>Java程序需要通过栈上的reference数据来操作堆上的具体对象。</p>
<h5 id="句柄访问"><a href="#句柄访问" class="headerlink" title="句柄访问"></a>句柄访问</h5><p>Java堆中将会划分出一块内存来作为句柄池，reference中存储的就是对象的句柄地址，而句柄中包含了对象实例数据与类型数据各自的具体地址信息<br><img src="https://i.loli.net/2019/08/22/M4REXhwbDQusnLp.png" alt="wpid-dcdfb554be82428073f802d4628207d9_0.831678370013833.png"></p>
<p>优势：reference中存储的是稳定的句柄地址，在对象被移动（垃圾收集时移动对象是非常普遍的行为）时只会改变句柄中的实例数据指针，而reference本身不需要修改。</p>
<h5 id="直接指针访问"><a href="#直接指针访问" class="headerlink" title="直接指针访问"></a>直接指针访问</h5><p>如果使用直接指针访问，那么Java堆对象的布局中就必须考虑如何放置访问类型数据的相关信息，而reference中存储的直接就是对象地址<br><img src="https://i.loli.net/2019/08/22/5IoE9temRSYJLTC.jpg" alt="20190714054758621_WNHEGT.jpg"><br>优势：速度更快，它节省了一次指针定位的时间开销，由于对象的访问在Java中非常频繁，因此这类开销积少成多后也是一项非常可观的执行成本</p>
<h3 id="OutOfMemoryError异常"><a href="#OutOfMemoryError异常" class="headerlink" title="OutOfMemoryError异常"></a>OutOfMemoryError异常</h3><h4 id="堆溢出-Java-heap-space"><a href="#堆溢出-Java-heap-space" class="headerlink" title="堆溢出 Java heap space"></a>堆溢出 Java heap space</h4><ol>
<li><p>设置虚拟机参数JVM堆初始堆大小，最大堆大小都为20m，不可扩展</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xms20M -Xmx20M</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> OOM;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeapOOM</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">OOMObject</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[]args)</span></span>&#123;</span><br><span class="line">        List&lt;OOMObject&gt; list=<span class="keyword">new</span> ArrayList&lt;OOMObject&gt;();</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            list.add(<span class="keyword">new</span> OOMObject());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行结果<br>当出现Java堆内存溢出时，异常堆栈信息”java.lang.OutOfMemoryError”会<br>跟着进一步提示”Java heap space”。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&quot;C:\Program Files\Java\jdk-9.0.4\bin\java.exe&quot; -Xms20M -Xmx20M &quot;-javaagent:C:\Program Files\JetBrains\IntelliJ IDEA 2018.1.8\lib\idea_rt.jar=14378:C:\Program Files\JetBrains\IntelliJ IDEA 2018.1.8\bin&quot; -Dfile.encoding=UTF-8 -classpath D:\myfiles\workspace\java\java_data_structure\target\classes OOM.HeapOOM</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">	at java.base/java.util.Arrays.copyOf(Arrays.java:3719)</span><br><span class="line">	at java.base/java.util.Arrays.copyOf(Arrays.java:3688)</span><br><span class="line">	at java.base/java.util.ArrayList.grow(ArrayList.java:237)</span><br><span class="line">	at java.base/java.util.ArrayList.grow(ArrayList.java:242)</span><br><span class="line">	at java.base/java.util.ArrayList.add(ArrayList.java:467)</span><br><span class="line">	at java.base/java.util.ArrayList.add(ArrayList.java:480)</span><br><span class="line">	at OOM.HeapOOM.main(HeapOOM.java:16)</span><br><span class="line">Process finished with exit code 1</span><br></pre></td></tr></table></figure>
</li>
<li><p>解决方案<br>要解决这个区域的异常，一般的手段是先通过内存映像分析工具<br>（Eclipse有Eclipse Memory Analyzer;IDEA的JProfiler;jmeter）对Dump出来的堆转储快照进行分析，重<br>点是确认内存中的对象是否是必要的，也就是要先分清楚到底是出现了<br>内存泄漏（Memory Leak）还是内存溢出（Memory Overflow）</p>
<h2 id="垃圾收集器与内存分配策略"><a href="#垃圾收集器与内存分配策略" class="headerlink" title="垃圾收集器与内存分配策略"></a>垃圾收集器与内存分配策略</h2><p>垃圾收集主要是针对堆和方法区进行。程序计数器、虚拟机栈和本地方法栈这三个区域属于线程私有的，只存在于线<br>程的生命周期内，线程结束之后就会消失，因此不需要对这三个区域进行垃圾回收。</p>
<h3 id="判断对象是否存活"><a href="#判断对象是否存活" class="headerlink" title="判断对象是否存活"></a>判断对象是否存活</h3><h4 id="1-引用计数算法"><a href="#1-引用计数算法" class="headerlink" title="1. 引用计数算法"></a>1. 引用计数算法</h4><p>为对象添加一个引用计数器，当对象增加一个引用时计数器加 1，引用失效时计数器减 1。引用计数为 0 的对象可被<br>回收。</p>
</li>
</ol>
<p>在两个对象出现循环引用的情况下，此时引用计数器永远不为 0，导致无法对它们进行回收。正是因为循环引用的存<br>在，因此 Java 虚拟机不使用引用计数算法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> Object instance = <span class="keyword">null</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Test a = <span class="keyword">new</span> Test();</span><br><span class="line">    Test b = <span class="keyword">new</span> Test();</span><br><span class="line">    a.instance = b;</span><br><span class="line">    b.instance = a;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>可达性分析算法<br>以 GC Roots 为起始点进行搜索，可达的对象都是存活的，不可达的对象可被回收。</li>
</ol>
<p><img src="https://i.loli.net/2019/08/21/6Gad9kAsVNJ41zK.png" alt="xeKfNyU.png"><br>可以作为GC Root的对象</p>
<ul>
<li>虚拟机栈中的引用的对象</li>
<li>方法区中的类静态属性引用的对象</li>
<li>方法区中的常量引用的对象</li>
<li>本地方法栈中JNI（native方法）的引用的对象<h4 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h4>无论是通过引用计数算法判断对象的引用数量，还是通过可达性分析算法判断对象的引用链是否可达，判定对象是否存活都与“引用”有关</li>
</ul>
<p>引用分为强引用<br>（Strong Reference）、软引用（Soft Reference）、弱引用（Weak<br>Reference）、虚引用（Phantom Reference）4种，这4种引用强度依次逐<br>渐减弱。</p>
<h5 id="强引用"><a href="#强引用" class="headerlink" title="强引用"></a>强引用</h5><p>就是指在程序代码之中普遍存在的，类似<code>Object obj=new
Object()</code>这类的引用，只要强引用还存在，垃圾收集器永远不会回收掉<br>被引用的对象。</p>
<h5 id="软引用"><a href="#软引用" class="headerlink" title="软引用"></a>软引用</h5><p>是用来描述一些还有用但并非必需的对象。对于软引用关联<br>着的对象，在系统将要发生内存溢出异常之前，将会把这些对象列进回<br>收范围之中进行第二次回收。如果这次回收还没有足够的内存，才会抛<br>出内存溢出异常。在JDK 1.2之后，提供了SoftReference类来实现软引<br>用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Object obj = <span class="keyword">new</span> Object();</span><br><span class="line">SoftReference&lt;Object&gt; sf = <span class="keyword">new</span> SoftReference&lt;Object&gt;(obj);</span><br><span class="line">obj = <span class="keyword">null</span>;  <span class="comment">// 使对象只被软引用关联</span></span><br></pre></td></tr></table></figure>

<h5 id="弱引用"><a href="#弱引用" class="headerlink" title="弱引用"></a>弱引用</h5><p>也是用来描述非必需对象的，但是它的强度比软引用更弱一<br>些，被弱引用关联的对象只能生存到下一次垃圾收集发生之前。当垃圾<br>收集器工作时，无论当前内存是否足够，都会回收掉只被弱引用关联的<br>对象。在JDK 1.2之后，提供了WeakReference类来实现弱引用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Object obj = <span class="keyword">new</span> Object();</span><br><span class="line">WeakReference&lt;Object&gt; wf = <span class="keyword">new</span> WeakReference&lt;Object&gt;(obj);</span><br><span class="line">obj = <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>

<h5 id="虚引用"><a href="#虚引用" class="headerlink" title="虚引用"></a>虚引用</h5><p>也称为幽灵引用或者幻影引用，它是最弱的一种引用关系。一个对象是否有虚引用的存在，完全不会对其生存时间构成影响，也无法通过虚引用来取得一个对象实例。为一个对象设置虚引用关联的唯一目的就是能在这个对象被收集器回收时收到一个系统通知。在JDK 1.2之后，提供了PhantomReference类来实现虚引用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Object obj = <span class="keyword">new</span> Object();</span><br><span class="line">PhantomReference&lt;Object&gt; pf = <span class="keyword">new</span> PhantomReference&lt;Object&gt;(obj);</span><br><span class="line">obj = <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>

<h4 id="回收条件"><a href="#回收条件" class="headerlink" title="回收条件"></a>回收条件</h4><p>即使在可达性分析算法中不可达的对象，也并非是“非死不可”的，这时候它们暂时处于“缓刑”阶段，要真正宣告一个对象死亡，至少要经历两次标记过程：如果对象在进行可达性分析后发现没有与GCRoots相连接的引用链，那它将会被第一次标记并且进行一次筛选，筛选的条件是此对象是否有必要执行finalize()方法。当对象没有覆盖finalize()方法，或者finalize()方法已经被虚拟机调用过，虚拟机将这两种情况都视为“没有必要执行”。</p>
<p>如果这个对象被判定为有必要执行finalize()方法，那么这个对象将<br>会放置在一个叫做F-Queue的队列之中，并在稍后由一个由虚拟机自动建立的、低优先级的Finalizer线程去执行它。这里所谓的“执行”是指虚拟机会触发这个方法，但并不承诺会等待它运行结束，这样做的原因是，如果一个对象在finalize()方法中执行缓慢，或者发生了死循环（更极端的情况），将很可能会导致F-Queue队列中其他对象永久处于等待，甚至导致整个内存回收系统崩溃。finalize()方法是对象逃脱死亡命运的最后一次机会，稍后GC将对F-Queue中的对象进行第二次小规模的标记，如果对象要在finalize()中成功拯救自己——只要重新与引用链上的任何一个对象建立关联即可，譬如把自己（this关键字）赋值给某个类变量或者对象的成员变量，那在第二次标记时它将被移除出“即将回收”的集合；如果对象这时候还没有逃脱，那基本上它就真的被回收<br>了</p>
<h3 id="回收方法区"><a href="#回收方法区" class="headerlink" title="回收方法区"></a>回收方法区</h3><p>方法区中进行垃圾收集的“性价比”一般比较低</p>
<h3 id="垃圾回收算法"><a href="#垃圾回收算法" class="headerlink" title="垃圾回收算法"></a>垃圾回收算法</h3><p>新生代：复制算法<br><img src="https://i.loli.net/2019/08/21/sYaTXpqd4xb1kDQ.png" alt="F3Mz2q.png"><br>缺点：空间折半</p>
<p>优点：简单，没有内存碎片</p>
<p>老年代：标记整理算法<br><img src="https://i.loli.net/2019/08/21/wU4AcvQY5sKIil2.png" alt="标记整理算法.png"></p>
<p>老年代：标记清理算法<br><img src="https://i.loli.net/2019/08/21/oSgCkBFuUNxT6id.png" alt="1ewzykxlrj.png"></p>
<h4 id="常见回收器"><a href="#常见回收器" class="headerlink" title="常见回收器"></a>常见回收器</h4><ul>
<li>Serial Garbage Collector:单线程GC</li>
<li>Parallel Garbage Collector：多线程GC</li>
<li>CMS Garbage Collector：多线程GC</li>
<li>G1 Garbage Collector：jdk7引进GC，多线程，高并发，低暂停，逐步取代CMS GC</li>
</ul>
<h3 id="执行引擎"><a href="#执行引擎" class="headerlink" title="执行引擎"></a>执行引擎</h3><hr>
<p>什么是JVM</p>
<p>JVM JDK JRE区别</p>
<p>JVM指令集</p>
<p>javap -c app.class app.txt</p>
<p>JVM性能调优：堆</p>
<p>jvm 分代回收</p>
<p>如何判断对象是否需要回收：<br>引用计数算法<br>GC ROOT</p>
<h3 id="JVM性能优化"><a href="#JVM性能优化" class="headerlink" title="JVM性能优化"></a>JVM性能优化</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//该程序的stop work 永远不会被输出</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span></span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> stop=<span class="keyword">false</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutDown</span><span class="params">()</span></span>&#123;</span><br><span class="line">        stop=<span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doWork</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(!stop)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        System.out.printf(<span class="string">"stop work"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main String[]args)&#123;</span><br><span class="line">        App app=<span class="keyword">new</span> App();</span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;app.doWork();&#125;).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;app.shutDown();&#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>每一个线程都会放在一个虚拟机栈中<br><img src="https://i.loli.net/2019/08/21/b1XO9CJYjPHcyE7.png" alt=".png"><br>volatile是C/C++实现的<br>java并发</p>
<p>CAS 线程池<br>线程安全<br>AQS<br>并行与并发<br>锁</p>
<p>如下几种情况，java虚拟机将结束生命周期：</p>
<ul>
<li>执行了System.exit()方法</li>
<li>程序正常执行结束</li>
<li>程序在执行过程中遇到了异常或错误而异常终止</li>
<li>由于操作系统出现错误而导致java虚拟机进程终止</li>
</ul>
<p>参考：</p>
<ul>
<li>《深入理解Java虚拟机》</li>
<li>深入分析Java ClassLoader原理：<a href="https://blog.csdn.net/xyang81/article/details/7292380" target="_blank" rel="noopener">https://blog.csdn.net/xyang81/article/details/7292380</a> </li>
<li>Java的自定义类加载器及JVM自带的类加载器之间的交互关系：<a href="https://blog.csdn.net/MDreamlove/article/details/79212420" target="_blank" rel="noopener">https://blog.csdn.net/MDreamlove/article/details/79212420</a></li>
</ul>
<p>JVM内存模型与JMM（Java内存模型）不是一回事</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/15/java移位运算符/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lichord">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lichord">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/15/java移位运算符/" class="post-title-link" itemprop="url">Java移位运算符</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-15 20:29:51" itemprop="dateCreated datePublished" datetime="2019-07-15T20:29:51+08:00">2019-07-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-09-22 20:14:03" itemprop="dateModified" datetime="2019-09-22T20:14:03+08:00">2019-09-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>java的三种移位运算符 ：&gt;&gt;&gt;,&gt;&gt; 和&lt;&lt;</p>
<p>计算机里面的带符号数用补码表示</p>
<ul>
<li>&lt;&lt;      :     带符号左移，</li>
<li>&gt;&gt;      :     带符号右移，</li>
<li>&gt;&gt;&gt;  :   无符号右移，忽略符号位，空位都以0补齐</li>
</ul>
<h3 id="lt-lt"><a href="#lt-lt" class="headerlink" title="&lt;&lt;"></a>&lt;&lt;</h3><ul>
<li>-12 在计算机中存储为二进制补码：1111  1111  1111  1111  1111  1111  1111  0100</li>
<li>-12 &lt;&lt; 3 即带符号左移3位，结果是：1111  1111  1111  1111  1111  1111  1010 0000</li>
<li>十进制：-96</li>
</ul>
<h3 id="gt-gt-移位之后，正数依然是正数，负数依然是负数"><a href="#gt-gt-移位之后，正数依然是正数，负数依然是负数" class="headerlink" title="&gt;&gt; 移位之后，正数依然是正数，负数依然是负数"></a>&gt;&gt; 移位之后，正数依然是正数，负数依然是负数</h3><ul>
<li>-12 在计算机中存储为二进制补码：1111  1111  1111  1111  1111  1111  1111  0100</li>
<li>-12 &gt;&gt; 3 即带符号右移3位，符号位=1移动时高位补1，结果是：1111  1111  1111  1111  1111  1111  1111  1110</li>
<li>十进制为： -2；<h3 id="gt-gt-gt-移位之后一定是正数"><a href="#gt-gt-gt-移位之后一定是正数" class="headerlink" title="&gt;&gt;&gt; 移位之后一定是正数"></a>&gt;&gt;&gt; 移位之后一定是正数</h3></li>
<li>-12 &gt;&gt;&gt; 3 就是右移三位，高位补零，为：0001  1111  1111  1111  1111  1111  1111  1110，十进制为：536870910。</li>
</ul>
<hr>
<p>正数的&gt;&gt;和&gt;&gt;&gt;结果是一样的，因为移动时都是高位补0</p>
<p>应用：</p>
<p>二分查找中 int mid = (left + right) &gt;&gt;&gt; 1;<br>可以保证left + right的和如果溢出也能得到正确结果</p>
<h2 id="移位运算符妙用"><a href="#移位运算符妙用" class="headerlink" title="移位运算符妙用"></a>移位运算符妙用</h2><p>要判断两个数符号是否相同时，可以对符号位进行异或运算</p>
<p>return ((a &gt;&gt; 31) ^ (b &gt;&gt; 31)) == 0;</p>
<hr>
<p>无论是左移还是右移（包括无符号右移），都有一个共同的规则。 如果移动的位数超过规定的bit数，都会与最大移位数取模之后进行计算。</p>
<p>例如：<br>int型，32bits，如果是5&lt;&lt;33，其实就是5&lt;&lt;1</p>
<hr>
<p>在JDK中，整形类型是有范围的，最大值为Integer.MAX_VALUE，即2147483647，最小值为Integer.MIN_VALUE -2147483648。</p>
<hr>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/12/sping ioc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lichord">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lichord">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/12/sping ioc/" class="post-title-link" itemprop="url">Spring IOC</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-12 10:14:23" itemprop="dateCreated datePublished" datetime="2019-07-12T10:14:23+08:00">2019-07-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-09-08 16:26:19" itemprop="dateModified" datetime="2019-09-08T16:26:19+08:00">2019-09-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javaweb/" itemprop="url" rel="index"><span itemprop="name">javaweb</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Spring IOC概念及作用</p>
<h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><ul>
<li>将创建对象的控制权放弃，交给工厂/框架，所以称为控制反转</li>
<li>包括依赖注入和依赖查找<h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4></li>
<li>解耦，降低程序间的依赖关系</li>
</ul>
<h2 id="基于XML的IOC环境搭建"><a href="#基于XML的IOC环境搭建" class="headerlink" title="基于XML的IOC环境搭建"></a>基于XML的IOC环境搭建</h2><p>spring5  版本是用 jdk8  编写的，所以要求 jdk 版本是 8  及以上。<br>时 同时 tomcat  的版本要求 8.5  及以上</p>
<h4 id="1-导入spring核心容器必须的jar包"><a href="#1-导入spring核心容器必须的jar包" class="headerlink" title="1.导入spring核心容器必须的jar包"></a>1.导入spring核心容器必须的jar包</h4><p>根据Spring的结构图可知，spring核心容器包括Beans,Core,Context,SpEL，此外还需要一个日志jar包</p>
<ul>
<li>所需jar包截图</li>
</ul>
<p><img src="https://i.loli.net/2019/07/11/5d26efaab361638997.png" alt="jar包.png"></p>
<ul>
<li>Spring结构图</li>
</ul>
<p><img src="https://i.loli.net/2019/07/11/5d26f054193e863577.png" alt="spring-overview.png"></p>
<ul>
<li>在maven的pom.xml文件中只需要导入context jar包就可以，maven会自动添加依赖包</li>
</ul>
<p><img src="https://i.loli.net/2019/07/11/5d26efaab513578301.png" alt="pom.png"></p>
<ul>
<li>可以在maven project窗口中项目jar包之间的依赖关系</li>
</ul>
<p><img src="https://i.loli.net/2019/07/11/5d26f0a139a0877529.png" alt="依赖关系.png"></p>
<ul>
<li>context依赖的包都会被导入，jcl包中封装了日志包，aop是使用注解时需要的包</li>
</ul>
<p><img src="https://i.loli.net/2019/07/11/5d26f0a13207391674.png" alt="依赖关系.png"></p>
<h4 id="2-创建业务层接口及实现类"><a href="#2-创建业务层接口及实现类" class="headerlink" title="2.创建业务层接口及实现类"></a>2.创建业务层接口及实现类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IAccountService</span> </span>&#123;</span><br><span class="line"><span class="comment">//模拟保存账户</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">saveAccount</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">IAccountService</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> IAccountDao accountDao = <span class="keyword">new</span> AccountDaoImpl();<span class="comment">// 此处的依赖关系有待解决</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveAccount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">accountDao.saveAccount();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-创建持久层接口及实现类"><a href="#3-创建持久层接口及实现类" class="headerlink" title="3.创建持久层接口及实现类"></a>3.创建持久层接口及实现类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IAccountDao</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">saveAccount</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title">IAccountDao</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveAccount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"保存了账户"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-创建spring配置文件applicationContext-xml"><a href="#4-创建spring配置文件applicationContext-xml" class="headerlink" title="4.创建spring配置文件applicationContext.xml"></a>4.创建spring配置文件applicationContext.xml</h4><p>配置dao和service，将对象的创建交给spring管理</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置 service --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.service.impl.AccountServiceImpl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置 dao --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDao"</span> <span class="attr">class</span>=<span class="string">"com.dao.impl.AccountDaoImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="5-测试"><a href="#5-测试" class="headerlink" title="5.测试"></a>5.测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//通过加载配置文件获取核心容器对象</span></span><br><span class="line">ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line"><span class="comment">//根据 bean 的 id 获取对象，这里两种获取方式都可</span></span><br><span class="line">IAccountService aService = (IAccountService) ac.getBean(<span class="string">"accountService"</span>);</span><br><span class="line">System.out.println(aService);</span><br><span class="line"></span><br><span class="line">IAccountDao aDao = (IAccountDao) ac.getBean(<span class="string">"accountDao"</span>);</span><br><span class="line">System.out.println(aDao);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="理解部分"><a href="#理解部分" class="headerlink" title="理解部分"></a>理解部分</h3><h4 id="ApplicationContext的三个实现类"><a href="#ApplicationContext的三个实现类" class="headerlink" title="ApplicationContext的三个实现类"></a>ApplicationContext的三个实现类</h4><ul>
<li>鼠标放在ApplicationContext上，右键-&gt;diagram-&gt;show diagram,可以看到其继承关系，BeanFactory就是spring核心容器的顶层接口</li>
</ul>
<p><img src="https://i.loli.net/2019/07/11/5d26f7521d8f425168.png" alt="ApplicationContext.png"></p>
<ul>
<li>在ApplicationContext上再次右键-&gt;show implementation可以看到接口的实现</li>
</ul>
<p><img src="https://i.loli.net/2019/07/12/5d2820d466fd181846.png" alt="接口实现.png"></p>
<ul>
<li>常用的三个：<ul>
<li>ClassPathXmlApplicationContext：可加载类路径下的配置文件，要求配置文件必须在类路径下。不在的话，加载不了。(更常用)</li>
<li>FileSystemXmlApplicationContext：可以加载磁盘任意路径下的配置文件(必须有访问权限）<code>ApplicationContext ac = new FileSystemXmlApplicationContext(&quot;C:\\Users\\HASEE\\Desktop\\application.xml&quot;);</code></li>
<li>AnnotationConfigApplicationContext：用于读取注解创建容器的</li>
</ul>
</li>
</ul>
<h4 id="BeanFactory-和-ApplicationContext-的区别"><a href="#BeanFactory-和-ApplicationContext-的区别" class="headerlink" title="BeanFactory 和 ApplicationContext  的区别"></a>BeanFactory 和 ApplicationContext  的区别</h4><ul>
<li>BeanFactory 才是 Spring 容器中的顶层接口,ApplicationContext 是它的子接口。</li>
<li>创建对象的时间点不一样,实际开发中根据具体情况选择<ul>
<li>ApplicationContext：创建对象采取的策略是采用立即加载的方式，只要一读取配置文件，默认情况下就会创建对象。(也可以延迟加载)</li>
<li>BeanFactory：创建对象采取的策略是采用延迟加载的方式，什么时候使用什么时候创建对象。 </li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//--------BeanFactory----------</span></span><br><span class="line">Resource resource = <span class="keyword">new</span> ClassPathResource(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">BeanFactory factory = <span class="keyword">new</span> XmlBeanFactory(resource);</span><br><span class="line">IAccountService as  = (IAccountService)factory.getBean(<span class="string">"accountService"</span>);</span><br><span class="line">System.out.println(as);</span><br></pre></td></tr></table></figure>

<h5 id="应用情况"><a href="#应用情况" class="headerlink" title="应用情况"></a>应用情况</h5><ul>
<li>ApplicationContext:     单例对象适用  （更多采用此接口）</li>
<li>BeanFactory:            多例对象使用</li>
</ul>
<h2 id="Spring对bean的管理细节"><a href="#Spring对bean的管理细节" class="headerlink" title="Spring对bean的管理细节"></a>Spring对bean的管理细节</h2><h3 id="创建bean的三种方式"><a href="#创建bean的三种方式" class="headerlink" title="创建bean的三种方式"></a>创建bean的三种方式</h3><h4 id="1-使用默认构造函数创建。"><a href="#1-使用默认构造函数创建。" class="headerlink" title="1.使用默认构造函数创建。"></a>1.使用默认构造函数创建。</h4><ul>
<li><p>在spring的配置文件中使用bean标签，配以id和class属性之后，且没有其他属性和标签时。<br>采用的就是默认构造函数创建bean对象，此时如果类中没有默认构造函数，则对象无法创建。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.service.impl.AccountServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-使用普通工厂中的方法创建对象（使用某个类中的方法创建对象，并存入spring容器）"><a href="#2-使用普通工厂中的方法创建对象（使用某个类中的方法创建对象，并存入spring容器）" class="headerlink" title="2.使用普通工厂中的方法创建对象（使用某个类中的方法创建对象，并存入spring容器）"></a>2.使用普通工厂中的方法创建对象（使用某个类中的方法创建对象，并存入spring容器）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"instanceFactory"</span> <span class="attr">class</span>=<span class="string">"com.factory.InstanceFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">factory-bean</span>=<span class="string">"instanceFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getAccountService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-使用工厂中的静态方法创建对象（使用某个类中的静态方法创建对象，并存入spring容器"><a href="#3-使用工厂中的静态方法创建对象（使用某个类中的静态方法创建对象，并存入spring容器" class="headerlink" title="3.使用工厂中的静态方法创建对象（使用某个类中的静态方法创建对象，并存入spring容器)"></a>3.使用工厂中的静态方法创建对象（使用某个类中的静态方法创建对象，并存入spring容器)</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.factory.StaticFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getAccountService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>第二，三种方式应用场景：使用jar包中或者别人写的类时，不能确定是否含义默认构造函数</p>
</li>
</ul>
<h3 id="bean对象的作用范围"><a href="#bean对象的作用范围" class="headerlink" title="bean对象的作用范围"></a>bean对象的作用范围</h3><h4 id="bean标签的scope属性："><a href="#bean标签的scope属性：" class="headerlink" title="bean标签的scope属性："></a>bean标签的scope属性：</h4><ul>
<li>作用：用于指定bean的作用范围</li>
<li>取值： 常用的就是单例的和多例的<ul>
<li>singleton：单例的（默认值）</li>
<li>prototype：多例的</li>
<li>request：作用于web应用的请求范围</li>
<li>session：作用于web应用的会话范围</li>
<li>global-session：作用于集群环境的会话范围（全局会话范围），当不是集群环境时，它就是session<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;accountService&quot; class=&quot;com.service.impl.AccountServiceImpl&quot; scope=&quot;prototype&quot;&gt;&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">//以下语句用singleton只会创建一次,as1=as2，用prototype会创建两次as1!=as2</span><br><span class="line">IAccountService as1  = (IAccountService)ac.getBean(&quot;accountService&quot;);</span><br><span class="line">IAccountService as2  = (IAccountService)ac.getBean(&quot;accountService&quot;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h6 id="全局session用于session在多台服务器处理时共享"><a href="#全局session用于session在多台服务器处理时共享" class="headerlink" title="全局session用于session在多台服务器处理时共享"></a>全局session用于session在多台服务器处理时共享</h6><p><img src="https://i.loli.net/2019/07/12/5d285f8020e2e38546.png" alt="全局session.png"></p>
<h3 id="bean对象的生命周期"><a href="#bean对象的生命周期" class="headerlink" title="bean对象的生命周期"></a>bean对象的生命周期</h3><h4 id="单例对象"><a href="#单例对象" class="headerlink" title="单例对象"></a>单例对象</h4><pre><code>出生：当容器创建时对象出生(立即加载)
活着：只要容器还在，对象一直活着
死亡：容器销毁，对象消亡
总结：单例对象的生命周期和容器相同</code></pre><h4 id="多例对象"><a href="#多例对象" class="headerlink" title="多例对象"></a>多例对象</h4><pre><code>出生：当我们使用对象时spring框架为我们创建（延迟加载）
活着：对象只要是在使用过程中就一直活着。
死亡：当对象长时间不用，且没有别的对象引用时，由Java的垃圾回收器回收</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;accountService&quot; class=&quot;com.service.impl.AccountServiceImpl&quot;</span><br><span class="line">          scope=&quot;prototype&quot; init-method=&quot;init&quot; destroy-method=&quot;destroy&quot;&gt;&lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br><span class="line">//</span><br><span class="line">init destroy方法需要在实现类中定义</span><br></pre></td></tr></table></figure>

<h2 id="Spring的依赖注入-Dependency-Injection"><a href="#Spring的依赖注入-Dependency-Injection" class="headerlink" title="Spring的依赖注入 Dependency Injection"></a>Spring的依赖注入 Dependency Injection</h2><p>依赖关系的管理，都交给spring来维护.在当前类需要用到其他类的对象，由spring为我们提供，我们只需要在配置文件中说明。依赖关系的维护，就称之为依赖注入。</p>
<h3 id="能注入的数据：有三类"><a href="#能注入的数据：有三类" class="headerlink" title="能注入的数据：有三类"></a>能注入的数据：有三类</h3><ul>
<li>基本类型和String</li>
<li>其他bean类型（在配置文件中或者注解配置过的bean）</li>
<li>复杂类型/集合类型</li>
</ul>
<h3 id="注入的方式：有三种"><a href="#注入的方式：有三种" class="headerlink" title="注入的方式：有三种"></a>注入的方式：有三种</h3><ul>
<li>使用构造函数提供</li>
<li>使用set方法提供</li>
<li>使用注解提供</li>
</ul>
<h4 id="1-构造函数注入：实际开发不常用"><a href="#1-构造函数注入：实际开发不常用" class="headerlink" title="1. 构造函数注入：实际开发不常用"></a>1. 构造函数注入：实际开发不常用</h4><h5 id="标签-constructor-arg"><a href="#标签-constructor-arg" class="headerlink" title="标签:constructor-arg"></a>标签:constructor-arg</h5><h5 id="位置-bean标签的内部"><a href="#位置-bean标签的内部" class="headerlink" title="位置:bean标签的内部"></a>位置:bean标签的内部</h5><h5 id="标签属性"><a href="#标签属性" class="headerlink" title="标签属性"></a>标签属性</h5><ul>
<li>type：用于指定要注入的数据的数据类型，该数据类型也是构造函数中某个或某些参数的类型</li>
<li>index：用于指定要注入的数据给构造函数中指定索引位置的参数赋值。索引的位置是从0开始</li>
<li>name：用于指定给构造函数中指定名称的参数赋值 (直接明确，常用)</li>
</ul>
<hr>
<p>以上用于找到构造函数参数</p>
<ul>
<li>value：用于提供基本类型和String类型的数据</li>
<li>ref：用于指定其他的bean类型数据。它指的就是在spring的Ioc核心容器中出现过的bean对象<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//service实现类构造器</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AccountServiceImpl</span><span class="params">(String name,Integer age,Date birthday)</span></span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.name = name;</span><br><span class="line">	<span class="keyword">this</span>.age = age;</span><br><span class="line">	<span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//配置文件</span></span><br><span class="line">&lt;bean id=<span class="string">"accountService"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.service.impl.AccountServiceImpl"</span>&gt;</span><br><span class="line">	&lt;constructor-arg name="name" value="泰斯特"&gt;&lt;/constructor-arg&gt;</span><br><span class="line">	&lt;constructor-arg name="age" value="18"&gt;&lt;/constructor-arg&gt;</span><br><span class="line">	&lt;constructor-arg name="birthday" ref="now"&gt;&lt;/constructor-arg&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;!-- 配置一个日期对象 --&gt;</span><br><span class="line">&lt;bean id="now" class="java.util.Date"&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="优势："><a href="#优势：" class="headerlink" title="优势："></a>优势：</h5><ul>
<li>在获取bean对象时，注入数据是必须的操作，否则对象无法创建成功。<h5 id="弊端："><a href="#弊端：" class="headerlink" title="弊端："></a>弊端：</h5></li>
<li>改变了bean对象的实例化方式，使我们在创建对象时，如果用不到这些数据，也必须提供。<h4 id="2-set方法注入-常用"><a href="#2-set方法注入-常用" class="headerlink" title="2. set方法注入 (常用)"></a>2. set方法注入 (常用)</h4><h5 id="标签：property"><a href="#标签：property" class="headerlink" title="标签：property"></a>标签：property</h5><h5 id="位置：bean标签的内部"><a href="#位置：bean标签的内部" class="headerlink" title="位置：bean标签的内部"></a>位置：bean标签的内部</h5><h5 id="标签属性-1"><a href="#标签属性-1" class="headerlink" title="标签属性"></a>标签属性</h5></li>
<li>name：用于指定注入时所调用的set方法名称</li>
<li>value：用于提供基本类型和String类型的数据</li>
<li>ref：用于指定其他的bean类型数据。它指的就是在spring的Ioc核心容器中出现过的bean对象</li>
</ul>
<h5 id="优势：-1"><a href="#优势：-1" class="headerlink" title="优势："></a>优势：</h5><ul>
<li>创建对象时没有明确的限制，可以直接使用默认构造函数</li>
</ul>
<h5 id="弊端：-1"><a href="#弊端：-1" class="headerlink" title="弊端："></a>弊端：</h5><ul>
<li>如果有某个成员必须有值，则获取对象是有可能set方法没有执行。</li>
</ul>
<h5 id="set方法-基本类型，bean类型注入"><a href="#set方法-基本类型，bean类型注入" class="headerlink" title="set方法 基本类型，bean类型注入"></a>set方法 基本类型，bean类型注入</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//set方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthday</span><span class="params">(Date birthday)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//bean配置</span></span><br><span class="line">&lt;bean id=<span class="string">"accountService"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.service.impl.AccountServiceImpl"</span>&gt;</span><br><span class="line">	&lt;property name="name" value="TEST" &gt;&lt;/property&gt;</span><br><span class="line">	&lt;property name="age" value="21"&gt;&lt;/property&gt;</span><br><span class="line">	&lt;property name="birthday" ref="now"&gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<h5 id="set方法-注入集合数据"><a href="#set方法-注入集合数据" class="headerlink" title="set方法 注入集合数据"></a>set方法 注入集合数据</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实现类的set方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMyStrs</span><span class="params">(String[] myStrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.myStrs = myStrs;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMyList</span><span class="params">(List&lt;String&gt; myList)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.myList = myList;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMySet</span><span class="params">(Set&lt;String&gt; mySet)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.mySet = mySet;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMyMap</span><span class="params">(Map&lt;String, String&gt; myMap)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.myMap = myMap;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMyProps</span><span class="params">(Properties myProps)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.myProps = myProps;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">//配置文件</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.service.impl.AccountServiceImpl"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"myStrs"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>AAA<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>BBB<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>CCC<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"myList"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>AAA<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>BBB<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>CCC<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mySet"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>AAA<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>BBB<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>CCC<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">用于给List结构集合注入的标签：list array set</span><br><span class="line">用于个Map结构集合注入的标签:map  props</span><br><span class="line">结构相同，标签可以互换</span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"myMap"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"testC"</span>&gt;</span>ccc<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"testD"</span>&gt;</span>ddd<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"myProps"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"testA"</span> <span class="attr">value</span>=<span class="string">"aaa"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"testB"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>BBB<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="基于注解的IOC-11个注解"><a href="#基于注解的IOC-11个注解" class="headerlink" title="基于注解的IOC(11个注解)"></a>基于注解的IOC(11个注解)</h2><p>环境搭建步骤与前面类似，只需要将配置文件xml配置换成注解</p>
<ul>
<li>XML的配置：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.service.impl.AccountServiceImpl"</span> <span class="attr">scope</span>=<span class="string">""</span>  <span class="attr">init-method</span>=<span class="string">""</span> <span class="attr">destroy-method</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">""</span>  <span class="attr">value</span>=<span class="string">""</span> | <span class="attr">ref</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="创建对象（4个"><a href="#创建对象（4个" class="headerlink" title="创建对象（4个)"></a>创建对象（4个)</h3><p>作用就和在XML配置文件中编写一个<code>&lt;bean&gt;</code>标签实现的功能是一样的</p>
<ul>
<li>Component:<ul>
<li>作用：用于把当前类对象存入spring容器中</li>
<li>属性：<br>  value：用于指定bean的id。当我们不写时，它的默认值是当前类名，且首字母改小写。</li>
</ul>
</li>
<li>Controller：一般用在表现层</li>
<li>Service：一般用在业务层</li>
<li>Repository：一般用在持久层<br>以上三个注解他们的作用和属性与Component是一模一样。<br>他们三个是spring框架为我们提供明确的三层使用的注解，使我们的三层对象更加清晰</li>
</ul>
<h4 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h4><ul>
<li>加入context名称空间，配置创建容器时要扫描的包，否则Component无效</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--告知spring在创建容器时要扫描的包，配置所需要的标签不是在beans的约束中，而是一个名称为context名称空间和约束中--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="实现类写法"><a href="#实现类写法" class="headerlink" title="实现类写法"></a>实现类写法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//所有写法作用一样</span></span><br><span class="line"><span class="meta">@Service</span>(<span class="string">"accountService"</span>)</span><br><span class="line"><span class="comment">//@Service(value="accountService")</span></span><br><span class="line"><span class="comment">//@Component("accountService")</span></span><br><span class="line"><span class="comment">////@Component(value="accountService")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">IAccountService</span> </span>&#123;</span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="注入数据-4个"><a href="#注入数据-4个" class="headerlink" title="注入数据(4个)"></a>注入数据(4个)</h3><p>作用就和在xml配置文件中的bean标签中写一个<code>&lt;property&gt;</code>标签的作用是一样的</p>
<h4 id="Autowired"><a href="#Autowired" class="headerlink" title="Autowired:"></a>Autowired:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>(<span class="string">"accountService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">IAccountService</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> IAccountDao accountDao = <span class="keyword">null</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">saveAccount</span><span class="params">()</span></span>&#123;</span><br><span class="line">	accountDao.saveAccount();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>作用：自动按照类型注入。<ul>
<li>只要容器中有唯一的一个bean对象类型和要注入的变量类型匹配，就可以注入成功</li>
<li>如果ioc容器中没有任何bean的类型和要注入的变量类型匹配，则报错。</li>
<li>如果Ioc容器中有多个类型匹配时：在匹配的类型中在对变量名称也就是bean的id匹配</li>
</ul>
</li>
<li>出现位置：<br>  可以是变量上，也可以是方法上</li>
<li>细节：<br>  在使用注解注入时，set方法就不是必须的了。</li>
<li>自动按照类型注入的查找过程<br><img src="https://i.loli.net/2019/07/12/5d288de5e86b371952.png" alt="自动按照类型注入.png"></li>
</ul>
<h4 id="Qualifier"><a href="#Qualifier" class="headerlink" title="Qualifier:"></a>Qualifier:</h4><ul>
<li>作用：在按照类中注入的基础之上再按照名称注入。它在给类成员注入时不能单独使用。但是在给方法参数注入时可以<ul>
<li>属性：value：用于指定注入bean的id。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>(<span class="string">"accountService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">IAccountService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"accountDao1"</span>)</span><br><span class="line">    <span class="keyword">private</span> IAccountDao accountDao = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">saveAccount</span><span class="params">()</span></span>&#123;</span><br><span class="line">        accountDao.saveAccount();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h4 id="Resource"><a href="#Resource" class="headerlink" title="Resource"></a>Resource</h4><ul>
<li>作用：直接按照bean的id注入。它可以独立使用</li>
<li>属性：<br>  name：用于指定bean的id。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>(<span class="string">"accountService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">IAccountService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"accountDao2"</span>)</span><br><span class="line">    <span class="keyword">private</span> IAccountDao accountDao = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">saveAccount</span><span class="params">()</span></span>&#123;</span><br><span class="line">        accountDao.saveAccount();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>以上三个注入都只能注入其他bean类型的数据，而基本类型和String类型无法使用上述注解实现。<br>另外，集合类型的注入只能通过XML来实现。</p>
<h4 id="Value"><a href="#Value" class="headerlink" title="Value"></a>Value</h4><ul>
<li>作用：用于注入基本类型和String类型的数据</li>
<li>属性：<ul>
<li>value：用于指定数据的值。它可以使用spring中SpEL(也就是spring的el表达式）</li>
<li>SpEL的写法：${表达式}<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.driver&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String driver;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h3 id="改变作用范围（1个）"><a href="#改变作用范围（1个）" class="headerlink" title="改变作用范围（1个）"></a>改变作用范围（1个）</h3><p>他们的作用就和在bean标签中使用scope属性实现的功能是一样的</p>
<h4 id="Scope"><a href="#Scope" class="headerlink" title="Scope"></a>Scope</h4><ul>
<li>作用：用于指定bean的作用范围</li>
<li>属性：value：指定范围的取值。常用取值：singleton prototype,默认单例</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>(<span class="string">"accountService"</span>)</span><br><span class="line"><span class="meta">@Scope</span>(<span class="string">"prototype"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">IAccountService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"accountDao2"</span>)</span><br><span class="line">    <span class="keyword">private</span> IAccountDao accountDao = <span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">saveAccount</span><span class="params">()</span></span>&#123;</span><br><span class="line">        accountDao.saveAccount();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="生命周期相关（2个）-了解"><a href="#生命周期相关（2个）-了解" class="headerlink" title="生命周期相关（2个） 了解"></a>生命周期相关（2个） 了解</h3><ul>
<li>作用：和在bean标签中使用init-method和destroy-methode的作用是一样的</li>
</ul>
<h4 id="PreDestroy"><a href="#PreDestroy" class="headerlink" title="PreDestroy"></a>PreDestroy</h4><ul>
<li>作用：用于指定销毁方法</li>
</ul>
<h4 id="PostConstruct"><a href="#PostConstruct" class="headerlink" title="PostConstruct"></a>PostConstruct</h4><ul>
<li>作用：用于指定初始化方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>(<span class="string">"accountService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">IAccountService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"accountDao2"</span>)</span><br><span class="line">    <span class="keyword">private</span> IAccountDao accountDao = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"初始化方法执行了"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">destroy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"销毁方法执行了"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">saveAccount</span><span class="params">()</span></span>&#123;</span><br><span class="line">        accountDao.saveAccount();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Spring新注解（5个）"><a href="#Spring新注解（5个）" class="headerlink" title="Spring新注解（5个）"></a>Spring新注解（5个）</h2><p>以上注解只能注入自己开发的类而不能注入jar包中的类</p>
<h3 id="bean中遗留配置"><a href="#bean中遗留配置" class="headerlink" title="bean中遗留配置"></a>bean中遗留配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dbAssit"</span> <span class="attr">class</span>=<span class="string">"com.dbassit.DBAssit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置数据源 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql:///spring_day02"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"1234"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h3><ul>
<li>作用：指定当前类是一个配置类</li>
<li>细节：当配置类作为AnnotationConfigApplicationContext对象创建的参数时，该注解可以不写。<ul>
<li>属性：<br>value:用于指定配置类的字节码</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext ac=<span class="keyword">new</span> AnnotationConfigApplicationContext(SpringConfiguration.class);</span><br><span class="line">IAccountService as=ac.getBean(<span class="string">"accountService"</span>,IAccountService.class);</span><br></pre></td></tr></table></figure>

<h3 id="ComponentScan"><a href="#ComponentScan" class="headerlink" title="@ComponentScan"></a>@ComponentScan</h3><ul>
<li>作用：用于通过注解指定spring在创建容器时要扫描的包</li>
<li>属性：<ul>
<li>value：它和basePackages的作用是一样的，都是用于指定创建容器时要扫描的包。<br>我们使用此注解就等同于在xml中配置了:<br><code>&lt;context:component-scan base-package=&quot;com&quot;&gt;&lt;/context:component-scan&gt;</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages=&#123;<span class="string">"com"</span>&#125;)</span><br><span class="line"><span class="comment">//@ComponentScan("com")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h3 id="Bean"><a href="#Bean" class="headerlink" title="Bean"></a>Bean</h3><ul>
<li>作用：用于把当前方法的返回值作为bean对象存入spring的ioc容器中</li>
<li>属性:<ul>
<li>name:用于指定bean的id。当不写时，默认值是当前方法的名称</li>
</ul>
</li>
<li>细节：当我们使用注解配置方法时，如果方法有参数，spring框架会去容器中查找有没有可用的bean对象。查找的方式和Autowired注解的作用是一样的</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>(name=<span class="string">"runner"</span>)</span><br><span class="line"><span class="meta">@Scope</span>(<span class="string">"prototype"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> QueryRunner <span class="title">createQueryRunner</span><span class="params">(@Qualifier(<span class="string">"ds2"</span>)</span> DataSource dataSource)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> QueryRunner(dataSource);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span>(name=<span class="string">"ds2"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> DataSource <span class="title">createDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	ComboPooledDataSource ds = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">	ds.setDriverClass(driver);</span><br><span class="line">	ds.setJdbcUrl(url);</span><br><span class="line">	ds.setUser(username);</span><br><span class="line">	ds.setPassword(password);</span><br><span class="line">	<span class="keyword">return</span> ds;</span><br><span class="line">&#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">	<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Import"><a href="#Import" class="headerlink" title="@Import"></a>@Import</h3><ul>
<li>作用：用于导入其他的配置类</li>
<li>属性：<ul>
<li>value：用于指定其他配置类的字节码。</li>
</ul>
</li>
<li>当我们使用Import的注解之后，有Import注解的类就父配置类，而导入的都是子配置类<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com"</span>)</span><br><span class="line"><span class="meta">@Import</span>(JdbcConfig.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="PropertySource"><a href="#PropertySource" class="headerlink" title="@PropertySource"></a>@PropertySource</h3><ul>
<li>作用：用于指定properties文件的位置</li>
<li>属性：<ul>
<li>value：指定文件的名称和路径。</li>
<li>关键字：classpath，表示类路径下</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan</span>(<span class="string">"com"</span>)</span><br><span class="line"><span class="meta">@Import</span>(JdbcConfig.class)</span><br><span class="line"><span class="meta">@PropertySource</span>(<span class="string">"classpath:jdbcConfig.properties"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>最方便的方式是xml+注解形式，自己写的类用注解更便捷，jar包中的类用xml更简洁</p>
<h2 id="Spring整合Junit"><a href="#Spring整合Junit" class="headerlink" title="Spring整合Junit"></a>Spring整合Junit</h2><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>在测试类中，每个测试方法都有以下两行代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean.xml"</span>);</span><br><span class="line">IAccountService as = ac.getBean(<span class="string">"accountService"</span>,IAccountService.class);</span><br></pre></td></tr></table></figure>

<ul>
<li>这两行代码的作用是获取容器，如果不写的话，直接会提示空指针异常。所以又不能轻易删掉。</li>
</ul>
<h3 id="Junit分析"><a href="#Junit分析" class="headerlink" title="Junit分析"></a>Junit分析</h3><ul>
<li>应用程序的入口：main方法</li>
<li>junit单元测试中，没有main方法也能执行<ul>
<li>junit集成了一个main方法</li>
<li>该方法就会判断当前测试类中哪些方法有 @Test注解</li>
<li>junit就让有Test注解的方法执行</li>
</ul>
</li>
<li>junit不会管我们是否采用spring框架，所以不会为我们读取配置文件/配置类创建spring核心容器</li>
<li>由以上三点可知：当测试方法执行时，没有Ioc容器，就算写了Autowired注解，也无法实现注入</li>
</ul>
<h3 id="Spring整合junit的配置"><a href="#Spring整合junit的配置" class="headerlink" title="Spring整合junit的配置"></a>Spring整合junit的配置</h3><ul>
<li>使用Junit提供的一个注解把原有的main方法替换了，替换成spring提供的：<strong>@Runwith</strong></li>
<li>告知spring的运行器，spring和ioc创建是基于xml还是注解的，并且说明位置</li>
</ul>
<p><strong>@ContextConfiguration</strong><br>    - locations：指定xml文件的位置，加上classpath关键字，表示在类路径下<br>    - classes：指定注解类所在地位置</p>
<ul>
<li>当我们使用spring 5.x版本的时候，要求junit的jar必须是4.12及以上</li>
</ul>
<h3 id="配置步骤"><a href="#配置步骤" class="headerlink" title="配置步骤"></a>配置步骤</h3><h4 id="1-导入Junit-jar包"><a href="#1-导入Junit-jar包" class="headerlink" title="1.导入Junit jar包"></a>1.导入Junit jar包</h4><h4 id="2-使用-RunWith"><a href="#2-使用-RunWith" class="headerlink" title="2.使用@RunWith"></a>2.使用@RunWith</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceTest</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-使用-ContextConfiguration-指定-spring-配置文件的位置"><a href="#3-使用-ContextConfiguration-指定-spring-配置文件的位置" class="headerlink" title="3.使用@ContextConfiguration  指定 spring  配置文件的位置"></a>3.使用@ContextConfiguration  指定 spring  配置文件的位置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(locations= &#123;<span class="string">"classpath:bean.xml"</span>&#125;)</span><br><span class="line"><span class="comment">//@ContextConfiguration(classes = SpringConfiguration.class)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceTest</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-使用-Autowired-给测试类中的变量注入数据"><a href="#4-使用-Autowired-给测试类中的变量注入数据" class="headerlink" title="4.使用@Autowired  给测试类中的变量注入数据"></a>4.使用@Autowired  给测试类中的变量注入数据</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(locations= &#123;<span class="string">"classpath:bean.xml"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceTest</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> IAccountService as ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="为什么到-不把测试类配到-xml"><a href="#为什么到-不把测试类配到-xml" class="headerlink" title="为什么到 不把测试类配到 xml"></a>为什么到 不把测试类配到 xml</h3><p>测试类配置在xml中也可以使用</p>
<ul>
<li>当我们在 xml 中配置了一个 bean，spring 加载配置文件创建容器时，就会创建对象。</li>
<li>测试类只是我们在测试功能时使用，而在项目中它并不参与程序逻辑，也不会解决需求上的问<br>题，所以创建完了，并没有使用。那么存在容器中就会造成资源的浪费。</li>
<li>基于以上两点，我们不应该把测试配置到xml</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/05/Axios传递数据注意事项/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lichord">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lichord">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/05/Axios传递数据注意事项/" class="post-title-link" itemprop="url">Axios传递数据注意事项</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-05 19:29:51" itemprop="dateCreated datePublished" datetime="2019-07-05T19:29:51+08:00">2019-07-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-09-08 15:10:02" itemprop="dateModified" datetime="2019-09-08T15:10:02+08:00">2019-09-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>jQuery.ajax的post提交默认的请求头的Content-Type: application/x-www-form-urlencoded 。相当于(username=”admin”&amp;password=123)来传递数据（这是GET请求的固定格式）</p>
<p>而axios.post提交的请求头是Content-Type: application/json。</p>
<p>不同的请求头发送给springmvc处理方式也不相同</p>
<h3 id="application-x-www-form-urlencoded"><a href="#application-x-www-form-urlencoded" class="headerlink" title="application/x-www-form-urlencoded"></a>application/x-www-form-urlencoded</h3><p>前端</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> user= &#123;</span><br><span class="line">                <span class="string">"username"</span> : username,</span><br><span class="line">                <span class="string">"password"</span> : password,</span><br><span class="line">                <span class="string">"rememberMe"</span>:rememberMe</span><br><span class="line">          &#125;;</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    url : <span class="string">"http://...../jsontest.do"</span>,</span><br><span class="line">    type : <span class="string">"POST"</span>,</span><br><span class="line">    <span class="keyword">async</span> : <span class="literal">true</span>,</span><br><span class="line">    data : user,</span><br><span class="line">    dataType : <span class="string">'json'</span>,</span><br><span class="line">    success : <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>后端</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/jsontest.do"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(User user,String username,String password,Boolean rememberMe)</span></span>&#123;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    System.out.println(<span class="string">"username: "</span> + username);</span><br><span class="line">    System.out.println(<span class="string">"password: "</span> + password);</span><br><span class="line">    System.out.println(<span class="string">"rememberMe: "</span> + rememberMe);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h5><ol>
<li>前端传递数据不用转换为json字符串：JSON.stringify(user) </li>
<li>后端接受的参数很灵活，即可以封装为User对象，亦可以使用单个参数username,rememberMe，甚至User对象和单个rememberMe参数混合使用都可以</li>
</ol>
<h3 id="application-json"><a href="#application-json" class="headerlink" title="application/json"></a>application/json</h3><p>前端：必须要将JSON对象转换为JSON字符串</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> user= &#123;</span><br><span class="line">                <span class="string">"username"</span> : username,</span><br><span class="line">                <span class="string">"password"</span> : password</span><br><span class="line">          &#125;;</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">        url : <span class="string">"http://...../jsontest.do"</span>,</span><br><span class="line">        type : <span class="string">"POST"</span>,</span><br><span class="line">        <span class="keyword">async</span> : <span class="literal">true</span>,</span><br><span class="line">        contentType: <span class="string">"application/json; charset=utf-8"</span>,</span><br><span class="line">        data : <span class="built_in">JSON</span>.stringify(user),</span><br><span class="line">        dataType : <span class="string">'json'</span>,</span><br><span class="line">        success : <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>

<p>后端 所有的参数都只能封装在对象中，不能单独设置参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/jsontest"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(@RequestBody User user  )</span></span>&#123;</span><br><span class="line">    String username = user.getUsername();</span><br><span class="line">    String password = user.getPassword();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/jsontest"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(@RequestBody Map map  )</span></span>&#123;</span><br><span class="line">    String username = map.get(<span class="string">"username"</span>).toString();</span><br><span class="line">    String password = map.get(<span class="string">"password"</span>).toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(@RequestBody String jsonData)</span> </span>&#123;</span><br><span class="line">    JSONObject jsonObject = JSON.parseObject(jsonData);</span><br><span class="line">    String username= jsonObject.getString(<span class="string">"username"</span>);</span><br><span class="line">    String username= jsonObject.getString(<span class="string">"password"</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="ajax改成axios"><a href="#ajax改成axios" class="headerlink" title="ajax改成axios"></a>ajax改成axios</h3><p>ajax</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = &#123;<span class="attr">age</span>: <span class="number">18</span>&#125;;</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    url: <span class="string">''</span>,</span><br><span class="line">    type: <span class="string">'POST'</span>,</span><br><span class="line">    data: data</span><br><span class="line">    dataType: <span class="string">'json'</span>,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>axios</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">'qs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data = &#123;<span class="attr">age</span>: <span class="number">18</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> url = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">axios.post(</span><br><span class="line">    url, </span><br><span class="line">    qs.stringify(data), </span><br><span class="line">    &#123;<span class="attr">headers</span>: &#123;<span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>&#125;&#125;</span><br><span class="line">).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="axios-POST数据三种请求方式"><a href="#axios-POST数据三种请求方式" class="headerlink" title="axios POST数据三种请求方式"></a>axios POST数据三种请求方式</h3><h4 id="Content-Type-application-json"><a href="#Content-Type-application-json" class="headerlink" title="Content-Type: application/json"></a>Content-Type: application/json</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="keyword">let</span> data = &#123;<span class="string">"code"</span>:<span class="string">"1234"</span>,<span class="string">"name"</span>:<span class="string">"yyyy"</span>&#125;;</span><br><span class="line">axios.post(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.$url&#125;</span>/test/testRequest`</span>,data)</span><br><span class="line">.then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'res=&gt;'</span>,res);            </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="Content-Type-multipart-form-data"><a href="#Content-Type-multipart-form-data" class="headerlink" title="Content-Type: multipart/form-data"></a>Content-Type: multipart/form-data</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="keyword">let</span> data = <span class="keyword">new</span> FormData();</span><br><span class="line">data.append(<span class="string">'code'</span>,<span class="string">'1234'</span>);</span><br><span class="line">data.append(<span class="string">'name'</span>,<span class="string">'yyyy'</span>);</span><br><span class="line">axios.post(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.$url&#125;</span>/test/testRequest`</span>,data)</span><br><span class="line">.then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'res=&gt;'</span>,res);            </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="Content-Type-application-x-www-form-urlencoded"><a href="#Content-Type-application-x-www-form-urlencoded" class="headerlink" title="Content-Type: application/x-www-form-urlencoded"></a>Content-Type: application/x-www-form-urlencoded</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">'Qs'</span></span><br><span class="line"><span class="keyword">let</span> data = &#123;<span class="string">"code"</span>:<span class="string">"1234"</span>,<span class="string">"name"</span>:<span class="string">"yyyy"</span>&#125;;</span><br><span class="line">axios.post(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.$url&#125;</span>/test/testRequest`</span>,qs.stringify(&#123;</span><br><span class="line">    data</span><br><span class="line">&#125;))</span><br><span class="line">.then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'res=&gt;'</span>,res);            </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/05/路由拦截/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lichord">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lichord">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/05/路由拦截/" class="post-title-link" itemprop="url">路由拦截</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-05 10:14:23" itemprop="dateCreated datePublished" datetime="2019-07-05T10:14:23+08:00">2019-07-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-09-08 15:14:42" itemprop="dateModified" datetime="2019-09-08T15:14:42+08:00">2019-09-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>定义路由的时候就需要多添加一个自定义字段requireAuth，用于判断该路由的访问是否需要登录。如果用户已经登录，则顺利进入路由，<br>否则就进入登录页面。</p>
<pre><code>const routes = [
    {
        path: &apos;/repository&apos;,
        name: &apos;repository&apos;,
        meta: {
            requireAuth: true,  // 添加该字段，表示进入这个路由是需要登录的
        },
        component: Repository
    }
];</code></pre>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/04/odoo学习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lichord">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lichord">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/04/odoo学习/" class="post-title-link" itemprop="url">Odoo学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-04 19:29:51" itemprop="dateCreated datePublished" datetime="2019-07-04T19:29:51+08:00">2019-07-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-09-08 15:11:00" itemprop="dateModified" datetime="2019-09-08T15:11:00+08:00">2019-09-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><ul>
<li><p>安装odoo和pycharm</p>
</li>
<li><p>windows:下载odoo的.exe文件按照默认指引安装就行，注意安装目录不能带有中文和空格，否则之后打开网页可能会报500 internal server error</p>
</li>
<li><p>odoo安装，pycharm安装以及配置，模块的安装详细步骤：<a href="https://pan.baidu.com/s/1Bfl-1ACbC8viabinKir9sg" target="_blank" rel="noopener">https://pan.baidu.com/s/1Bfl-1ACbC8viabinKir9sg</a><br>提取码：krxy </p>
<h3 id="开发"><a href="#开发" class="headerlink" title="开发"></a>开发</h3><h4 id="用脚手架创建新模块"><a href="#用脚手架创建新模块" class="headerlink" title="用脚手架创建新模块"></a>用脚手架创建新模块</h4><p>用Pycharm打开安装odoo目录下的server文件夹，在Terminal中输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python .\odoo-bin scaffold todo mymoudles</span><br></pre></td></tr></table></figure>
</li>
<li><p>todo是新模块的名字，mymoudles是文件夹名</p>
</li>
<li><p>出现依赖包不存在的报错信息就pip install安装依赖就行</p>
</li>
<li><p>创建成功会增加如下文件夹<br><img src="https://i.loli.net/2019/07/22/5d35c27bc1bd120016.png" alt="目录.png"></p>
</li>
<li><p>也可以手动创建文件夹和文件来创建模块</p>
<h4 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">todo</span><br><span class="line">├── \_\_init__.py</span><br><span class="line">├── \_\_manifest__.py</span><br><span class="line">├── controllers</span><br><span class="line">│   ├── \_\_init__.py</span><br><span class="line">│   └── controllers.py</span><br><span class="line">├── demo</span><br><span class="line">│   └── demo.xml</span><br><span class="line">├── models</span><br><span class="line">│   ├── \_\_init__.py</span><br><span class="line">│   └── models.py</span><br><span class="line">├── security</span><br><span class="line">│   └── ir.model.access.csv</span><br><span class="line">└── views</span><br><span class="line">    ├── templates.xml</span><br><span class="line">    └── views.xml</span><br></pre></td></tr></table></figure>
</li>
<li><p>每一个python包下都有一个<strong>init</strong>.py文件，一个odoo模块也是一个python包</p>
<h5 id="init-py"><a href="#init-py" class="headerlink" title="init.py"></a><strong>init</strong>.py</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&lt;!-- 引入了 controllers 和 models 这两个包 --&gt;</span><br><span class="line">from . import controllers</span><br><span class="line">from . import models</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="manifest-py"><a href="#manifest-py" class="headerlink" title="manifest.py"></a><strong>manifest</strong>.py</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&#123;</span><br><span class="line">    &apos;name&apos;: &quot;todo&quot;,</span><br><span class="line"></span><br><span class="line">    &apos;summary&apos;: &quot;&quot;&quot;</span><br><span class="line">        Short (1 phrase/line) summary of the module&apos;s purpose, used as</span><br><span class="line">        subtitle on modules listing or apps.openerp.com&quot;&quot;&quot;,</span><br><span class="line"></span><br><span class="line">    &apos;description&apos;: &quot;&quot;&quot;</span><br><span class="line">        Long description of module&apos;s purpose</span><br><span class="line">    &quot;&quot;&quot;,</span><br><span class="line"></span><br><span class="line">    &apos;author&apos;: &quot;My Company&quot;,</span><br><span class="line">    &apos;website&apos;: &quot;http://www.yourcompany.com&quot;,</span><br><span class="line"></span><br><span class="line">    # Categories can be used to filter modules in modules listing</span><br><span class="line">    # Check https://github.com/odoo/odoo/blob/master/odoo/addons/base/module/module_data.xml</span><br><span class="line">    # for the full list</span><br><span class="line">    &apos;category&apos;: &apos;Uncategorized&apos;,</span><br><span class="line">    &apos;version&apos;: &apos;0.1&apos;,</span><br><span class="line"></span><br><span class="line">    # any module necessary for this one to work correctly</span><br><span class="line">    &apos;depends&apos;: [&apos;base&apos;],</span><br><span class="line"></span><br><span class="line">    # always loaded</span><br><span class="line">    &apos;data&apos;: [</span><br><span class="line">        # &apos;security/ir.model.access.csv&apos;,</span><br><span class="line">        &apos;views/views.xml&apos;,</span><br><span class="line">        &apos;views/templates.xml&apos;,</span><br><span class="line">    ],</span><br><span class="line">    # only loaded in demonstration mode</span><br><span class="line">    &apos;demo&apos;: [</span><br><span class="line">        &apos;demo/demo.xml&apos;,</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>用于声明一个 Odoo 模块以及指定它的元数据（metadata）</p>
</li>
<li><p>文件里只包含了一个单独的 Python 字典，里面默认只列出了 9 项最基本的配置项，包含了模块（或应用）名，模块的简介和详细介绍，作者和网站，模块的所属分类、版本，还有就是这个模块依赖于其他的哪些 Odoo 模块，需要加载哪些数据文件以及演示数据。</p>
</li>
<li><p>除了这里列出的配置项外，还有一些高级配置项</p>
<h5 id="mvc"><a href="#mvc" class="headerlink" title="mvc"></a>mvc</h5></li>
<li><p>models,controllers,views文件夹分别存放控制层，模型层，视图层的代码</p>
<h5 id="demo-demo-xml"><a href="#demo-demo-xml" class="headerlink" title="demo/demo.xml"></a>demo/demo.xml</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;odoo&gt;</span><br><span class="line">    &lt;data&gt;</span><br><span class="line">        &lt;!--   &lt;record id=&quot;object0&quot; model=&quot;todo.todo&quot;&gt; --&gt;</span><br><span class="line">        &lt;!--     &lt;field name=&quot;name&quot;&gt;Object 0&lt;/field&gt; --&gt;</span><br><span class="line">        &lt;!--     &lt;field name=&quot;value&quot;&gt;0&lt;/field&gt; --&gt;</span><br><span class="line">        &lt;!--   &lt;/record&gt; --&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--   &lt;record id=&quot;object1&quot; model=&quot;todo.todo&quot;&gt; --&gt;</span><br><span class="line">        &lt;!--     &lt;field name=&quot;name&quot;&gt;Object 1&lt;/field&gt; --&gt;</span><br><span class="line">        &lt;!--     &lt;field name=&quot;value&quot;&gt;10&lt;/field&gt; --&gt;</span><br><span class="line">        &lt;!--   &lt;/record&gt; --&gt;      </span><br><span class="line">    &lt;/data&gt;</span><br><span class="line">&lt;/odoo&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>存放演示数据，在使用演示模式时，初始化一些演示数据可以帮我们节省不少的时间</p>
<h5 id="security-ir-model-access-csv"><a href="#security-ir-model-access-csv" class="headerlink" title="security/ir.model.access.csv"></a>security/ir.model.access.csv</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">access_todo_todo,todo.todo,model_todo_todo,,1,0,0,0</span><br></pre></td></tr></table></figure>
</li>
<li><p>与安全有关</p>
</li>
<li><p>用于定义不同的角色组对应于不同模型的相关权限，包括读（read），写（write），创建（create）和删除（unlink）权限，拥有相关权限则为 1，反之为 0。</p>
</li>
<li><p>默认角色组的定义和模型权限定义在同一目录下，角色组的定义使用.xml 文件</p>
</li>
</ul>
<h4 id="创建模型"><a href="#创建模型" class="headerlink" title="创建模型"></a>创建模型</h4><ul>
<li><p>models/models.py将注释内容删掉，不要修改文件顶部引入的包，添加以下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class TodoTask(models.Model):</span><br><span class="line">     _name = &apos;todo.task&apos;</span><br><span class="line">     _description = &apos;待办事项&apos;</span><br><span class="line">     &lt;!--  name 和 is_done 两个字段，它们的类型分别是 Char 和 Boolean，并且我们指定字段 name 是必填的（添加了 required=True） --&gt;</span><br><span class="line">     name = fields.Char(&apos;描述&apos;, required=True)</span><br><span class="line">     is_done = fields.Boolean(&apos;已完成？&apos;)</span><br><span class="line">     &lt;!--Selection会显示下拉框选项，(&apos;todo&apos;, &apos;待办&apos;)左边的是数据库中存储的值，右边的是一个用于界面显示的描述。</span><br><span class="line">    默认值 todo，可以为任意类型的字段添加默认值--&gt;</span><br><span class="line">     priority = fields.Selection([</span><br><span class="line">        (&apos;todo&apos;, &apos;待办&apos;),</span><br><span class="line">        (&apos;normal&apos;, &apos;普通&apos;),</span><br><span class="line">        (&apos;urgency&apos;, &apos;紧急&apos;)</span><br><span class="line">    ], default=&apos;todo&apos;, string=&apos;紧急程度&apos;)</span><br><span class="line">    &lt;!-- 选择日期 --&gt;</span><br><span class="line">    deadline = fields.Datetime(u&apos;截止时间&apos;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>_name ： 模型的名称，在外键或者实例化模型对象时会用到，是模型的唯一标识，是定义一个新的模型时必须要有的属性</p>
</li>
<li><p>_description ： 模型的描述，描述模型的作用，一般情况下不会主动使用到</p>
</li>
<li><p>除了上面列出的两个特殊属性外，还有一些其他属性，例如更改默认显示名称时会用到 _rec_name，继承现有模型时会用到 _inherit 等</p>
</li>
<li><p>模型改变后需要对模块进行升级才能看到变化</p>
<h4 id="创建菜单"><a href="#创建菜单" class="headerlink" title="创建菜单"></a>创建菜单</h4></li>
<li><p>菜单就是能够在网页安装模块后打开该模块应用的入口</p>
</li>
<li><p>在模块里的 views 目录下创建一个 menus.xml 文件，然后输入以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;odoo&gt;</span><br><span class="line">    &lt;data&gt;</span><br><span class="line">        &lt;!-- 主菜单定义 id是菜单唯一标识，name是菜单显示的名字--&gt;</span><br><span class="line">        &lt;menuitem id=&quot;menu_todo&quot; name=&quot;Todo&quot;/&gt;</span><br><span class="line">        &lt;!-- 菜单动作定义 model是动作类型，act_window 表示我们定义的这个动作是和窗口有关--&gt;</span><br><span class="line">        &lt;record id=&quot;action_todo_task&quot; model=&quot;ir.actions.act_window&quot;&gt;</span><br><span class="line">            &lt;field name=&quot;name&quot;&gt;待办事项&lt;/field&gt;</span><br><span class="line">            &lt;field name=&quot;res_model&quot;&gt;todo.task&lt;/field&gt;</span><br><span class="line">            &lt;field name=&quot;view_type&quot;&gt;form&lt;/field&gt;</span><br><span class="line">            &lt;field name=&quot;view_mode&quot;&gt;tree,form&lt;/field&gt;</span><br><span class="line">            &lt;field name=&quot;target&quot;&gt;current&lt;/field&gt;</span><br><span class="line">        &lt;/record&gt;</span><br><span class="line">        &lt;!-- 子菜单定义 action 的值是我们定义的动作的 id，点击这个菜单，就执行对应 id 的动作。sequence 用于指定当前菜单的位置--&gt;</span><br><span class="line">        &lt;menuitem action=&quot;action_todo_task&quot; id=&quot;submenu_todo_task&quot; name=&quot;待办事项&quot;</span><br><span class="line">                  parent=&quot;menu_todo&quot; sequence=&quot;10&quot;/&gt;</span><br><span class="line">    &lt;/data&gt;</span><br><span class="line">&lt;/odoo&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>把menus.xml放到<strong>manifest</strong>.py 的 data 列表中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&apos;data&apos;: [</span><br><span class="line">    # &apos;security/ir.model.access.csv&apos;,</span><br><span class="line">    &apos;views/views.xml&apos;,</span><br><span class="line">    &apos;views/templates.xml&apos;,</span><br><span class="line">    &apos;views/menus.xml&apos;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h4><ul>
<li><p>默认在列表页只显示了一个 name 字段,我们可以根据自己的需求定义视图</p>
</li>
<li><p>打开views/views.xml，把里面注释掉的内容都删掉，然后添加以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;odoo&gt;</span><br><span class="line">    &lt;data&gt;</span><br><span class="line">        &lt;record id=&quot;todo_task_view_tree&quot; model=&quot;ir.ui.view&quot;&gt;</span><br><span class="line">            &lt;field name=&quot;name&quot;&gt;todo.task.view_tree&lt;/field&gt;</span><br><span class="line">            &lt;field name=&quot;model&quot;&gt;todo.task&lt;/field&gt;</span><br><span class="line">            &lt;field name=&quot;type&quot;&gt;tree&lt;/field&gt;</span><br><span class="line">            &lt;field name=&quot;arch&quot; type=&quot;xml&quot;&gt;</span><br><span class="line">                &lt;tree string=&quot;Todo&quot;&gt;</span><br><span class="line">                    &lt;field name=&quot;name&quot;/&gt;</span><br><span class="line">                    &lt;field name=&quot;is_done&quot;/&gt;</span><br><span class="line">                &lt;/tree&gt;</span><br><span class="line">            &lt;/field&gt;</span><br><span class="line">        &lt;/record&gt;</span><br><span class="line">    &lt;/data&gt;</span><br><span class="line">&lt;/odoo&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建视图相关的内容，我们需要指定属性 model=”ir.ui.view”</p>
</li>
<li><p>type：列表视图，填写 tree，表单视图， form，除了这两种视图外还有其他类型的视图</p>
</li>
<li><p>arch，显示视图内容，列表视图用tree 包裹，表单视图form，需要在列表视图中将要显示的字段列举出来</p>
</li>
</ul>
<h4 id="参考-amp-更多"><a href="#参考-amp-更多" class="headerlink" title="参考&amp;更多"></a>参考&amp;更多</h4><ul>
<li>创建模块，菜单，视图：<a href="https://segmentfault.com/a/1190000014047552#articleHeader1" target="_blank" rel="noopener">https://segmentfault.com/a/1190000014047552#articleHeader1</a></li>
<li>计算字段，视图装饰器：<a href="https://segmentfault.com/a/1190000016052104" target="_blank" rel="noopener">https://segmentfault.com/a/1190000016052104</a></li>
<li>关联字段，视图排版：<a href="https://segmentfault.com/a/1190000016065404" target="_blank" rel="noopener">https://segmentfault.com/a/1190000016065404</a></li>
<li>搜索字段，过滤器，分组：<a href="https://segmentfault.com/a/1190000016364580" target="_blank" rel="noopener">https://segmentfault.com/a/1190000016364580</a></li>
<li>动作：<a href="https://segmentfault.com/a/1190000016463150" target="_blank" rel="noopener">https://segmentfault.com/a/1190000016463150</a></li>
<li>用户组，权限：<a href="https://segmentfault.com/a/1190000016969012" target="_blank" rel="noopener">https://segmentfault.com/a/1190000016969012</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Lichord</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">21</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lichord</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>
